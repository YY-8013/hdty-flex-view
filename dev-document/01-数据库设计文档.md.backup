# 数据晾晒统计系统 - 数据库设计文档

## 📊 数据库概述

### 1.1 设计原则
- **通用性**: 采用JSON存储+字段映射的方式，支持动态扩展
- **高性能**: 重要字段冗余到表列，建立索引提升查询效率
- **可维护**: 清晰的表结构设计，便于后期维护
- **规范性**: 遵循Oracle数据库设计规范

### 1.2 字符集与表空间
```sql
-- 字符集: AL32UTF8
-- 表空间: HDTY_DATA (根据实际情况调整)
```

---

## 🗂️ 表结构设计

### 2.1 配置管理模块

#### 2.1.1 列配置表 (T_SJLS_COLUMN_CONFIG)
存储数据统计列表的列配置信息,支持树形结构。

```sql
CREATE TABLE T_SJLS_COLUMN_CONFIG (
    F_ID                VARCHAR2(32) PRIMARY KEY,           -- 主键ID
    F_PARENT_ID         VARCHAR2(32),                       -- 父节点ID (NULL表示根节点)
    F_LABEL             VARCHAR2(100) NOT NULL,             -- 列显示名称
    F_PROP              VARCHAR2(100),                      -- 属性名名 (叶子节点必填)
    F_COLUMN_WIDTH      NUMBER(10),                         -- 列宽度
    F_ALIGN             VARCHAR2(20) DEFAULT 'center',      -- 对齐方式: left/center/right
    F_FIXED             VARCHAR2(20),                       -- 固定列: left/right/NULL
    F_SORTABLE          VARCHAR2(10) DEFAULT 'false',       -- 是否可排序: true/false
    F_DEFAULT_EXPAND    VARCHAR2(10) DEFAULT 'true',        -- 默认展开: true/false
    F_FORM_ID           VARCHAR2(32),                       -- 关联表单ID (可点击录入时配置)
    F_CALC_TYPE         VARCHAR2(50),                       -- 计算类型: sum/avg/count/custom
    F_CALC_RULE         CLOB,                               -- 计算规则 (JSON格式)

    
    -- 前端配置(新增,存储前端特有的渲染配置)
    F_COLUMN_CONFIG     CLOB,                               -- 列配置JSON(样式、格式化、条件显示等)
    
    F_SORT_NUM          NUMBER(10) DEFAULT 0,               -- 排序号
    
    -- 启用状态及操作信息
    F_STATUS            VARCHAR2(1) DEFAULT '1' NOT NULL,   -- 启用状态: 1-启用 0-停用
    F_STATUS_REMARK     VARCHAR2(500),                      -- 启用/停用备注
    F_ENABLE_USER_GMSFHM VARCHAR2(18),                      -- 启用操作人身份证号
    F_ENABLE_USERNAME   VARCHAR2(50),                       -- 启用操作人姓名
    F_ENABLE_TIME       VARCHAR2(14),                       -- 启用操作时间
    F_DISABLE_USER_GMSFHM VARCHAR2(18),                     -- 停用操作人身份证号
    F_DISABLE_USERNAME  VARCHAR2(50),                       -- 停用操作人姓名
    F_DISABLE_TIME      VARCHAR2(14),                       -- 停用操作时间
    
    -- 注销标识
    F_ZXBS              VARCHAR2(1) DEFAULT '0' NOT NULL,   -- 注销状态: 0-未注销 1-已注销
    F_ZXR_USER_GMSFHM   VARCHAR2(18),                       -- 注销人身份证号
    F_ZXR_USERNAME      VARCHAR2(30),                       -- 注销人姓名
    F_ZXDW              VARCHAR2(12),                       -- 注销机构
    F_ZXSJ              VARCHAR2(14),                       -- 注销时间
    F_ZXYY              VARCHAR2(500),                      -- 注销原因
    
    -- 系统字段
    F_CREATE_USER_GMSFHM VARCHAR2(18),                      -- 采集人身份证号
    F_CREATE_USERNAME   VARCHAR2(50),                       -- 采集人姓名
    F_CREATE_TIME       VARCHAR2(14),                       -- 采集时间
    F_CREATE_ORG_ID     VARCHAR2(12),                       -- 采集人机构
    F_UPDATE_USER_GMSFHM VARCHAR2(18),                      -- 操作人身份证号
    F_UPDATE_USERNAME   VARCHAR2(50),                       -- 操作人姓名
    F_UPDATE_TIME       VARCHAR2(14),                       -- 操作时间
    F_UPDATE_ORG_ID     VARCHAR2(12),                       -- 操作人机构
    F_MEMO              VARCHAR2(500),                      -- 备注
    
    CONSTRAINT FK_COLUMN_PARENT FOREIGN KEY (F_PARENT_ID) REFERENCES T_SJLS_COLUMN_CONFIG(F_ID)
);

-- 索引
CREATE INDEX IDX_COLUMN_PARENT ON T_SJLS_COLUMN_CONFIG(F_PARENT_ID);
CREATE INDEX IDX_COLUMN_ZXBS ON T_SJLS_COLUMN_CONFIG(F_ZXBS);
CREATE INDEX IDX_COLUMN_SORT ON T_SJLS_COLUMN_CONFIG(F_SORT_NUM);

-- 注释
COMMENT ON TABLE T_SJLS_COLUMN_CONFIG IS '统计列配置表';
COMMENT ON COLUMN T_SJLS_COLUMN_CONFIG.F_ID IS '主键ID';
COMMENT ON COLUMN T_SJLS_COLUMN_CONFIG.F_PARENT_ID IS '父节点ID';
COMMENT ON COLUMN T_SJLS_COLUMN_CONFIG.F_LABEL IS '列显示名称';
COMMENT ON COLUMN T_SJLS_COLUMN_CONFIG.F_PROP IS '属性名名';
COMMENT ON COLUMN T_SJLS_COLUMN_CONFIG.F_FORM_ID IS '关联表单ID(可点击录入)';
COMMENT ON COLUMN T_SJLS_COLUMN_CONFIG.F_DEFAULT_EXPAND IS '默认展开状态';
COMMENT ON COLUMN T_SJLS_COLUMN_CONFIG.F_COLUMN_CONFIG IS '列前端配置JSON(样式、格式化、条件显示等)';
COMMENT ON COLUMN T_SJLS_COLUMN_CONFIG.F_STATUS IS '启用状态:1-启用 0-停用';
COMMENT ON COLUMN T_SJLS_COLUMN_CONFIG.F_STATUS_REMARK IS '启用/停用备注说明';
COMMENT ON COLUMN T_SJLS_COLUMN_CONFIG.F_CREATE_USER_GMSFHM IS '采集人身份证号码';
COMMENT ON COLUMN T_SJLS_COLUMN_CONFIG.F_ZXR_USER_GMSFHM IS '注销人身份证号码';
```

**COLUMN_CONFIG JSON配置说明**(列前端配置):

COLUMN_CONFIG字段存储列的前端特有配置,包括样式、格式化、条件显示等。

```json
{
  // 样式配置
  "style": {
    "color": "#333",              // 字体颜色
    "fontWeight": "normal",      // 字体粗细: normal/bold
    "background": "#f5f7fa"      // 背景色
  },
  
  // 数据格式化
  "formatter": {
    "type": "number",            // 格式类型: number/percent/date/custom
    "precision": 2,              // 小数位数
    "suffix": "%",              // 后缀
    "prefix": "¥",              // 前缀
    "dateFormat": "yyyy-MM-dd", // 日期格式
    "custom": "formatCustom"     // 自定义格式化函数名
  },
  
  // 条件显示(根据数据值改变样式)
  "conditional": {
    "rules": [
      {
        "condition": "value > 90",   // 条件表达式
        "style": {
          "color": "#67C23A"          // 绿色(良好)
        }
      },
      {
        "condition": "value < 60",
        "style": {
          "color": "#F56C6C"          // 红色(差)
        }
      }
    ]
  },
  
  // 自定义渲染
  "render": {
    "type": "badge",             // 渲染类型: text/badge/link/button/tag
    "props": {                   // 渲染组件属性
      "type": "success"
    }
  },
  
  // 图表配置(在单元格中显示小图表)
  "chart": {
    "enabled": true,             // 是否启用
    "type": "line",              // 图表类型: line/bar/pie
    "dataSource": "trendData"   // 数据源字段
  },
  
  // 点击事件
  "click": {
    "enabled": true,             // 是否可点击
    "style": {
      "cursor": "pointer",
      "color": "#409EFF",
      "textDecoration": "underline"
    }
  }
}
```

**示例数据**:
```sql
-- 实有人口父节点
INSERT INTO T_SJLS_COLUMN_CONFIG (F_ID, F_PARENT_ID, F_LABEL, F_PROP, F_SORT_NUM,
    F_ZXBS, F_CREATE_USER_ID, F_CREATE_USERNAME, F_CREATE_TIME, F_CREATE_ORG_ID,
    F_UPDATE_USER_ID, F_UPDATE_USERNAME, F_UPDATE_TIME, F_UPDATE_ORG_ID) 
VALUES ('COL001', NULL, '实有人口', NULL, 1,
    '0', 'admin', '管理员', '20251125120000', '000000',
    'admin', '管理员', '20251125120000', '000000');

-- 总数子节点(不可点击)
INSERT INTO T_SJLS_COLUMN_CONFIG (F_ID, F_PARENT_ID, F_LABEL, F_PROP, F_COLUMN_WIDTH, F_SORT_NUM, F_COLUMN_CONFIG,
    F_ZXBS, F_CREATE_USER_ID, F_CREATE_USERNAME, F_CREATE_TIME, F_CREATE_ORG_ID,
    F_UPDATE_USER_ID, F_UPDATE_USERNAME, F_UPDATE_TIME, F_UPDATE_ORG_ID)
VALUES ('COL001001', 'COL001', '总数', 'population_total', 100, 1,
    '{"formatter":{"type":"number","precision":0}}',
    '0', 'admin', '管理员', '20251125120000', '000000',
    'admin', '管理员', '20251125120000', '000000');

-- 抽查总数子节点(可点击,有样式)
INSERT INTO T_SJLS_COLUMN_CONFIG (F_ID, F_PARENT_ID, F_LABEL, F_PROP, F_COLUMN_WIDTH, F_FORM_ID, F_SORT_NUM, F_COLUMN_CONFIG,
    F_ZXBS, F_CREATE_USER_ID, F_CREATE_USERNAME, F_CREATE_TIME, F_CREATE_ORG_ID,
    F_UPDATE_USER_ID, F_UPDATE_USERNAME, F_UPDATE_TIME, F_UPDATE_ORG_ID)
VALUES ('COL001002', 'COL001', '抽查总数', 'check_total', 100, 'FORM001', 2,
    '{"click":{"enabled":true,"style":{"cursor":"pointer","color":"#409EFF","textDecoration":"underline"}},"formatter":{"type":"number","precision":0}}',
    '0', 'admin', '管理员', '20251125120000', '000000',
    'admin', '管理员', '20251125120000', '000000');

-- 核查率子节点(条件格式化)
INSERT INTO T_SJLS_COLUMN_CONFIG (F_ID, F_PARENT_ID, F_LABEL, F_PROP, F_COLUMN_WIDTH, F_SORT_NUM, F_COLUMN_CONFIG,
    F_ZXBS, F_CREATE_USER_ID, F_CREATE_USERNAME, F_CREATE_TIME, F_CREATE_ORG_ID,
    F_UPDATE_USER_ID, F_UPDATE_USERNAME, F_UPDATE_TIME, F_UPDATE_ORG_ID)
VALUES ('COL001003', 'COL001', '核查率', 'check_rate', 100, 3,
    '{"formatter":{"type":"percent","precision":2,"suffix":"%"},"conditional":{"rules":[{"condition":"value >= 95","style":{"color":"#67C23A"}},{"condition":"value < 80","style":{"color":"#F56C6C"}}]}}',
    '0', 'admin', '管理员', '20251125120000', '000000',
    'admin', '管理员', '20251125120000', '000000');
```

---

#### 2.1.2 表单配置表 (T_SJLS_FORM_CONFIG)
存储动态表单的基础信息,支持分表配置。

```sql
CREATE TABLE T_SJLS_FORM_CONFIG (
    F_ID                VARCHAR2(32) PRIMARY KEY,           -- 主键ID
    F_FORM_CODE         VARCHAR2(100) NOT NULL UNIQUE,      -- 表单编码
    F_FORM_NAME         VARCHAR2(200) NOT NULL,             -- 表单名称
    F_DATA_TABLE        VARCHAR2(100) DEFAULT 'BIZ_DATA_COMMON',  -- 数据存储表名(默认为BIZ_DATA_COMMON)
    F_FORM_TYPE         VARCHAR2(50) DEFAULT 'COMMON',      -- 表单类型: COMMON-通用/CUSTOM-自定义
    F_DESCRIPTION       VARCHAR2(500),                      -- 表单说明
    F_FORM_CONFIG       CLOB,                               -- 表单配置JSON(表单级别的配置)
    
    -- 注销标识
    F_ZXBS              VARCHAR2(1) DEFAULT '0' NOT NULL,   -- 注销状态: 0-未注销 1-已注销
    F_ZXR_USER_GMSFHM   VARCHAR2(18),                       -- 注销人身份证号
    F_ZXR_USERNAME      VARCHAR2(30),                       -- 注销人姓名
    F_ZXDW              VARCHAR2(12),                       -- 注销机构
    F_ZXSJ              VARCHAR2(14),                       -- 注销时间
    F_ZXYY              VARCHAR2(500),                      -- 注销原因
    
    -- 系统字段
    F_CREATE_USER_GMSFHM VARCHAR2(18) NOT NULL,             -- 采集人身份证号
    F_CREATE_USERNAME   VARCHAR2(50) NOT NULL,              -- 采集人姓名
    F_CREATE_TIME       VARCHAR2(14) NOT NULL,              -- 采集时间
    F_CREATE_ORG_ID     VARCHAR2(12) NOT NULL,              -- 采集人机构
    F_UPDATE_USER_GMSFHM VARCHAR2(18) NOT NULL,             -- 操作人身份证号
    F_UPDATE_USERNAME   VARCHAR2(50) NOT NULL,              -- 操作人姓名
    F_UPDATE_TIME       VARCHAR2(14) NOT NULL,              -- 操作时间
    F_UPDATE_ORG_ID     VARCHAR2(12) NOT NULL,              -- 操作人机构
    F_MEMO              VARCHAR2(500),                      -- 备注
    F_VERSION           NUMBER(10) DEFAULT 1                -- 版本号
);

-- 索引
CREATE INDEX IDX_FORM_CODE ON T_SJLS_FORM_CONFIG(F_FORM_CODE);
CREATE INDEX IDX_FORM_ZXBS ON T_SJLS_FORM_CONFIG(F_ZXBS);
CREATE INDEX IDX_FORM_TABLE ON T_SJLS_FORM_CONFIG(F_DATA_TABLE);

-- 注释
COMMENT ON TABLE T_SJLS_FORM_CONFIG IS '表单配置表';
COMMENT ON COLUMN T_SJLS_FORM_CONFIG.F_FORM_CODE IS '表单编码(唯一)';
COMMENT ON COLUMN T_SJLS_FORM_CONFIG.F_DATA_TABLE IS '数据存储表名(默认BIZ_DATA_COMMON,支持分表)';
COMMENT ON COLUMN T_SJLS_FORM_CONFIG.F_VERSION IS '表单版本号';
```

**示例数据**:
```sql
-- 抽查记录表单(使用默认表)
INSERT INTO T_SJLS_FORM_CONFIG (F_ID, F_FORM_CODE, F_FORM_NAME, F_DATA_TABLE, F_DESCRIPTION,
    F_ZXBS, F_CREATE_USER_ID, F_CREATE_USERNAME, F_CREATE_TIME, F_CREATE_ORG_ID,
    F_UPDATE_USER_ID, F_UPDATE_USERNAME, F_UPDATE_TIME, F_UPDATE_ORG_ID) 
VALUES ('FORM001', 'CHECK_RECORD', '抽查记录表单', 'BIZ_DATA_COMMON', '用于录入抽查相关信息',
    '0', 'admin', '管理员', '20251125120000', '000000',
    'admin', '管理员', '20251125120000', '000000');

-- 矛盾纠纷表单(使用分表)
INSERT INTO T_SJLS_FORM_CONFIG (F_ID, F_FORM_CODE, F_FORM_NAME, F_DATA_TABLE, F_DESCRIPTION,
    F_ZXBS, F_CREATE_USER_ID, F_CREATE_USERNAME, F_CREATE_TIME, F_CREATE_ORG_ID,
    F_UPDATE_USER_ID, F_UPDATE_USERNAME, F_UPDATE_TIME, F_UPDATE_ORG_ID)
VALUES ('FORM002', 'DISPUTE_RECORD', '矛盾纠纷表单', 'BIZ_DATA_DISPUTE', '单独分表存储矛盾纠纷数据',
    '0', 'admin', '管理员', '20251125120000', '000000',
    'admin', '管理员', '20251125120000', '000000');
```

---

#### 2.1.3 表单组件配置表 (SYS_FORM_ITEM_CONFIG)
存储表单组件的详细配置信息(参考现有系统设计)。

```sql
CREATE TABLE SYS_FORM_ITEM_CONFIG (
    ID                VARCHAR2(32) PRIMARY KEY,           -- 组件ID(主键)
    FORM_ID           VARCHAR2(32) NOT NULL,              -- 表单ID
    ITEM_TYPE         VARCHAR2(20),                       -- 组件类型: input/select/date/textarea/button等
    ITEM_LABEL        VARCHAR2(200),                      -- 组件标签
    ITEM_PROP         VARCHAR2(200),                      -- 组件绑定表单对象属性名
    ITEM_ORDER        NUMBER(10),                         -- 组件排序
    
    -- 显示控制字段(提取出来)
    SHOW_IN_FORM      VARCHAR2(1) DEFAULT '1',            -- 是否在表单中显示: 1-是 0-否
    SHOW_IN_LIST      VARCHAR2(1) DEFAULT '0',            -- 是否在列表中显示: 1-是 0-否
    SHOW_IN_QUERY     VARCHAR2(1) DEFAULT '0',            -- 是否作为查询条件: 1-是 0-否
    COLUMN_WIDTH      NUMBER(10),                         -- 列表列宽
    IS_DISABLED       VARCHAR2(1) DEFAULT '0',            -- 是否禁用: 1-是 0-否
    IS_READONLY       VARCHAR2(1) DEFAULT '0',            -- 是否只读: 1-是 0-否
    IS_REQUIRED       VARCHAR2(1) DEFAULT '0',            -- 是否必填: 1-是 0-否
    
    -- 数据映射字段(提取出来)
    IS_FIXED          VARCHAR2(1) DEFAULT '0' NOT NULL,   -- 是否为固定项(映射到表列): 1-是 0-否
    TABLE_KEY         VARCHAR2(100),                      -- 固定属性对应的数据库列名(如:FIELD_1/ORG_ID/DICT_1等)
    KEY_TYPE          VARCHAR2(10),                       -- 列类型: field/org/region/dict/num/date
    DATA_TYPE         VARCHAR2(20),                       -- 数据类型: VARCHAR2/NUMBER/DATE/CLOB
    DIC_TYPE          VARCHAR2(100),                      -- 字典类型编码(KEY_TYPE=dict时使用)
    
    -- 组件配置(JSON格式,仅存储组件特有的渲染配置)
    ITEM_CONFIG       CLOB,                               -- 组件配置JSON(组件属性、选项数据、联动规则、布局等)
    
    -- 注销标识
    ZXBS              VARCHAR2(1) DEFAULT '0' NOT NULL,   -- 注销状态: 0-未注销 1-已注销
    ZXR_USER_GMSFHM   VARCHAR2(18),                       -- 注销人身份证号
    ZXR_USERNAME      VARCHAR2(30),                       -- 注销人姓名
    ZXDW              VARCHAR2(12),                       -- 注销机构
    ZXSJ              VARCHAR2(14),                       -- 注销时间
    ZXYY              VARCHAR2(500),                      -- 注销原因
    
    -- 系统字段
    CREATE_USER_GMSFHM VARCHAR2(18) NOT NULL,             -- 采集人身份证号
    CREATE_USERNAME   VARCHAR2(50) NOT NULL,              -- 采集人姓名
    CREATE_TIME       VARCHAR2(14) NOT NULL,              -- 采集时间
    CREATE_ORG_ID     VARCHAR2(12) NOT NULL,              -- 采集人机构
    UPDATE_USER_GMSFHM VARCHAR2(18) NOT NULL,             -- 操作人身份证号
    UPDATE_USERNAME   VARCHAR2(50) NOT NULL,              -- 操作人姓名
    UPDATE_TIME       VARCHAR2(14) NOT NULL,              -- 操作时间
    UPDATE_ORG_ID     VARCHAR2(12) NOT NULL,              -- 操作人机构
    MEMO              VARCHAR2(500),                      -- 备注
    
    CONSTRAINT FK_ITEM_FORM FOREIGN KEY (FORM_ID) REFERENCES SYS_FORM_CONFIG(ID)
);

-- 索引
CREATE INDEX IDX_ITEM_FORM ON SYS_FORM_ITEM_CONFIG(FORM_ID);
CREATE INDEX IDX_ITEM_ZXBS ON SYS_FORM_ITEM_CONFIG(ZXBS);
CREATE INDEX IDX_ITEM_ORDER ON SYS_FORM_ITEM_CONFIG(ITEM_ORDER);
CREATE INDEX IDX_ITEM_PROP ON SYS_FORM_ITEM_CONFIG(ITEM_PROP);

-- 注释
COMMENT ON TABLE SYS_FORM_ITEM_CONFIG IS '表单组件配置表';
COMMENT ON COLUMN SYS_FORM_ITEM_CONFIG.ID IS '组件ID(主键)';
COMMENT ON COLUMN SYS_FORM_ITEM_CONFIG.ITEM_TYPE IS '组件类型';
COMMENT ON COLUMN SYS_FORM_ITEM_CONFIG.ITEM_PROP IS '绑定表单对象属性名';
COMMENT ON COLUMN SYS_FORM_ITEM_CONFIG.SHOW_IN_FORM IS '是否在表单中显示';
COMMENT ON COLUMN SYS_FORM_ITEM_CONFIG.SHOW_IN_LIST IS '是否在列表中显示';
COMMENT ON COLUMN SYS_FORM_ITEM_CONFIG.SHOW_IN_QUERY IS '是否作为查询条件';
COMMENT ON COLUMN SYS_FORM_ITEM_CONFIG.IS_FIXED IS '是否为固定项(映射到预留字段)';
COMMENT ON COLUMN SYS_FORM_ITEM_CONFIG.TABLE_KEY IS '映射的数据库列名(如:FIELD_1/ORG_ID/DICT_1)';
COMMENT ON COLUMN SYS_FORM_ITEM_CONFIG.KEY_TYPE IS '列类型:field/org/region/dict/num/date';
COMMENT ON COLUMN SYS_FORM_ITEM_CONFIG.ITEM_CONFIG IS '组件配置JSON(仅含组件特有配置,不含显示控制和数据映射)';
```

**ITEM_CONFIG JSON配置说明**(精简版,仅含组件特有配置):

ITEM_CONFIG字段现在仅存储组件特有的渲染配置,显示控制和数据映射已提取为独立字段。

```json
{
  // 基础配置
  "defaultValue": "",              // 默认值
  "placeholder": "请选择抽查时间",   // 占位符
  
  // 验证规则(仅自定义规则,必填等基础规则已提取)
  "rules": {
    "message": "抽查时间不能为空",   // 提示信息
    "trigger": "blur",              // 触发方式: blur/change
    "maxLength": 100,               // 最大长度
    "minLength": 0,                 // 最小长度
    "pattern": "",                   // 正则表达式
    "validator": ""                  // 自定义校验器名称
  },
  
  // 选项配置(select/radio/checkbox等)
  "options": {
    "data": [                        // 静态选项数据
      {"label": "合格", "value": "1"},
      {"label": "不合格", "value": "0"}
    ],
    "remote": {                      // 远程数据源
      "url": "/api/dict/list",
      "method": "GET",
      "params": {"type": "check_result"}
    }
  },
  
  // 组件特定配置
  "componentProps": {
    "type": "date",                 // input类型: text/number/password等
    "format": "yyyy-MM-dd",         // 日期格式
    "valueFormat": "yyyy-MM-dd",   // 值格式
    "size": "medium",              // 尺寸: large/medium/small/mini
    "clearable": true,             // 是否可清空
    "multiple": false,             // 是否多选(select)
    "filterable": false,           // 是否可搜索(select)
    "rows": 3,                     // 行数(textarea)
    "maxlength": 200,              // 最大输入长度
    "showWordLimit": false         // 是否显示字数统计
  },
  
  // 联动配置
  "linkage": {
    "trigger": "checkResult",       // 触发字段
    "rules": [                       // 联动规则
      {
        "condition": "checkResult == '0'",  // 条件
        "action": "show",                    // 动作: show/hide/enable/disable
        "target": "failReason"               // 目标字段
      }
    ]
  },
  
  // 布局配置
  "layout": {
    "span": 12,                     // 栅格占位(24栅格系统)
    "labelWidth": "120px"           // 标签宽度
  }
}
```

**示例数据**(使用新的独立字段结构):
```sql
-- 抽查时间组件(PC表单)
INSERT INTO SYS_FORM_ITEM_CONFIG (
    ID, FORM_ID, ITEM_TYPE, ITEM_LABEL, ITEM_PROP, ITEM_ORDER,
    -- 显示控制字段(已提取)
    SHOW_IN_FORM, SHOW_IN_LIST, SHOW_IN_QUERY, COLUMN_WIDTH, IS_REQUIRED,
    -- 数据映射字段(已提取)
    IS_FIXED, TABLE_KEY, KEY_TYPE, DATA_TYPE,
    -- 组件配置(JSON,仅包含组件特有配置)
    ITEM_CONFIG,
    USE_TYPE, ZXBS, CREATE_USER_ID, CREATE_USERNAME, CREATE_TIME, CREATE_ORG_ID,
    UPDATE_USER_ID, UPDATE_USERNAME, UPDATE_TIME, UPDATE_ORG_ID
) VALUES (
    'ITEM001', 'FORM001', 'date', '抽查时间', 'checkTime', 1,
    '1', '1', '1', 120, '1',  -- 表单显示/列表显示/查询/列宽/必填
    '1', 'DATE_1', 'date', 'DATE',  -- 固定映射到DATE_1字段
    '{"placeholder":"请选择抽查时间","rules":{"message":"抽查时间不能为空","trigger":"blur"},"componentProps":{"type":"date","format":"yyyy-MM-dd","valueFormat":"yyyy-MM-dd","clearable":true},"layout":{"span":12,"labelWidth":"120px"}}',
    '04', '0', 'admin', '管理员', '20251125120000', '000000',
    'admin', '管理员', '20251125120000', '000000'
);

-- 抽查人员组件(映射到FIELD_1)
INSERT INTO SYS_FORM_ITEM_CONFIG (
    ID, FORM_ID, ITEM_TYPE, ITEM_LABEL, ITEM_PROP, ITEM_ORDER,
    SHOW_IN_FORM, SHOW_IN_LIST, SHOW_IN_QUERY, COLUMN_WIDTH, IS_REQUIRED,
    IS_FIXED, TABLE_KEY, KEY_TYPE, DATA_TYPE,
    ITEM_CONFIG,
    USE_TYPE, ZXBS, CREATE_USER_ID, CREATE_USERNAME, CREATE_TIME, CREATE_ORG_ID,
    UPDATE_USER_ID, UPDATE_USERNAME, UPDATE_TIME, UPDATE_ORG_ID
) VALUES (
    'ITEM002', 'FORM001', 'input', '抽查人员', 'checker', 2,
    '1', '1', '1', 100, '1',
    '1', 'FIELD_1', 'field', 'VARCHAR2',  -- 映射到预留字段FIELD_1
    '{"placeholder":"请输入抽查人员","componentProps":{"clearable":true,"maxlength":50},"layout":{"span":12}}',
    '04', '0', 'admin', '管理员', '20251125120000', '000000',
    'admin', '管理员', '20251125120000', '000000'
);

-- 抽查结果组件(下拉框,字典翻译,映射到DICT_1)
INSERT INTO SYS_FORM_ITEM_CONFIG (
    ID, FORM_ID, ITEM_TYPE, ITEM_LABEL, ITEM_PROP, ITEM_ORDER,
    SHOW_IN_FORM, SHOW_IN_LIST, SHOW_IN_QUERY, COLUMN_WIDTH, IS_REQUIRED,
    IS_FIXED, TABLE_KEY, KEY_TYPE, DATA_TYPE, DIC_TYPE,
    ITEM_CONFIG,
    USE_TYPE, ZXBS, CREATE_USER_ID, CREATE_USERNAME, CREATE_TIME, CREATE_ORG_ID,
    UPDATE_USER_ID, UPDATE_USERNAME, UPDATE_TIME, UPDATE_ORG_ID
) VALUES (
    'ITEM003', 'FORM001', 'select', '抽查结果', 'checkResult', 3,
    '1', '1', '1', 100, '1',
    '1', 'DICT_1', 'dict', 'VARCHAR2', 'check_result',  -- 字典类型,映射到DICT_1
    '{"placeholder":"请选择抽查结果","options":{"data":[{"label":"合格","value":"1"},{"label":"不合格","value":"0"}]},"componentProps":{"clearable":true,"filterable":false},"layout":{"span":12}}',
    '04', '0', 'admin', '管理员', '20251125120000', '000000',
    'admin', '管理员', '20251125120000', '000000'
);

-- 所属机构组件(映射到ORG_ID)
INSERT INTO SYS_FORM_ITEM_CONFIG (
    ID, FORM_ID, ITEM_TYPE, ITEM_LABEL, ITEM_PROP, ITEM_ORDER,
    SHOW_IN_FORM, SHOW_IN_LIST, SHOW_IN_QUERY, COLUMN_WIDTH, IS_REQUIRED,
    IS_FIXED, TABLE_KEY, KEY_TYPE, DATA_TYPE,
    ITEM_CONFIG,
    USE_TYPE, ZXBS, CREATE_USER_ID, CREATE_USERNAME, CREATE_TIME, CREATE_ORG_ID,
    UPDATE_USER_ID, UPDATE_USERNAME, UPDATE_TIME, UPDATE_ORG_ID
) VALUES (
    'ITEM004', 'FORM001', 'select', '所属机构', 'orgId', 4,
    '1', '1', '1', 150, '1',
    '1', 'ORG_ID', 'org', 'VARCHAR2',  -- 机构类型,映射到ORG_ID
    '{"placeholder":"请选择机构","options":{"remote":{"url":"/api/org/tree","method":"GET"}},"componentProps":{"clearable":true,"filterable":true},"layout":{"span":12}}',
    '04', '0', 'admin', '管理员', '20251125120000', '000000',
    'admin', '管理员', '20251125120000', '000000'
);

-- 备注字段(非固定字段,仅存JSON)
INSERT INTO SYS_FORM_ITEM_CONFIG (
    ID, FORM_ID, ITEM_TYPE, ITEM_LABEL, ITEM_PROP, ITEM_ORDER,
    SHOW_IN_FORM, SHOW_IN_LIST, IS_REQUIRED,
    IS_FIXED,  -- 不映射到固定字段
    ITEM_CONFIG,
    USE_TYPE, ZXBS, CREATE_USER_ID, CREATE_USERNAME, CREATE_TIME, CREATE_ORG_ID,
    UPDATE_USER_ID, UPDATE_USERNAME, UPDATE_TIME, UPDATE_ORG_ID
) VALUES (
    'ITEM005', 'FORM001', 'textarea', '备注', 'remark', 5,
    '1', '0', '0',  -- 仅在表单显示,不在列表,非必填
    '0',  -- 不是固定项,仅存储在JSON中
    '{"placeholder":"请输入备注","rules":{"maxLength":500},"componentProps":{"rows":3,"maxlength":500,"showWordLimit":true},"layout":{"span":24}}',
    '04', '0', 'admin', '管理员', '20251125120000', '000000',
    'admin', '管理员', '20251125120000', '000000'
);
```

**字段映射说明**:

| 组件     | ITEM_PROP   | IS_FIXED | TABLE_KEY | KEY_TYPE | 说明             |
| -------- | ----------- | -------- | --------- | -------- | ---------------- |
| 抽查时间 | checkTime   | 1        | DATE_1    | date     | 映射到日期字段1  |
| 抽查人员 | checker     | 1        | FIELD_1   | field    | 映射到预留字段1  |
| 抽查结果 | checkResult | 1        | DICT_1    | dict     | 映射到字典字段1  |
| 所属机构 | orgId       | 1        | ORG_ID    | org      | 映射到机构ID字段 |
| 备注     | remark      | 0        | -         | -        | 不映射,仅存JSON  |
```

---

### 2.2 业务数据模块

#### 2.2.1 通用业务数据表 (BIZ_DATA_COMMON)
采用"JSON存储+预留字段映射"的方式存储业务数据,支持动态映射和分表。

```sql
CREATE TABLE BIZ_DATA_COMMON (
    ID                VARCHAR2(32) PRIMARY KEY,           -- 主键ID
    FORM_ID           VARCHAR2(32) NOT NULL,              -- 表单ID
    DATA_JSON         CLOB NOT NULL,                      -- 完整数据(JSON格式)
    
    -- 预留通用字段(支持动态映射)
    -- 字符串字段(20个)
    FIELD_1           VARCHAR2(200),                      -- 预留字段1
    FIELD_2           VARCHAR2(200),                      -- 预留字段2
    FIELD_3           VARCHAR2(200),                      -- 预留字段3
    FIELD_4           VARCHAR2(200),                      -- 预留字段4
    FIELD_5           VARCHAR2(200),                      -- 预留字段5
    FIELD_6           VARCHAR2(500),                      -- 预留字段6(长文本)
    FIELD_7           VARCHAR2(500),                      -- 预留字段7(长文本)
    FIELD_8           VARCHAR2(500),                      -- 预留字段8(长文本)
    FIELD_9           VARCHAR2(100),                      -- 预留字段9
    FIELD_10          VARCHAR2(100),                      -- 预留字段10
    FIELD_11          VARCHAR2(100),                      -- 预留字段11
    FIELD_12          VARCHAR2(100),                      -- 预留字段12
    FIELD_13          VARCHAR2(100),                      -- 预留字段13
    FIELD_14          VARCHAR2(100),                      -- 预留字段14
    FIELD_15          VARCHAR2(100),                      -- 预留字段15
    FIELD_16          VARCHAR2(100),                      -- 预留字段16
    FIELD_17          VARCHAR2(100),                      -- 预留字段17
    FIELD_18          VARCHAR2(100),                      -- 预留字段18
    FIELD_19          VARCHAR2(100),                      -- 预留字段19
    FIELD_20          VARCHAR2(100),                      -- 预留字段20
    
    -- 机构相关字段(5个)
    ORG_ID            VARCHAR2(32),                       -- 机构ID
    ORG_NAME          VARCHAR2(200),                      -- 机构名称
    PARENT_ORG_ID     VARCHAR2(32),                       -- 上级机构ID
    ORG_LEVEL         VARCHAR2(10),                       -- 机构层级
    ORG_PATH          VARCHAR2(500),                      -- 机构路径
    
    -- 行政区划字段(3个)
    REGION_ID         VARCHAR2(20),                       -- 行政区划ID
    REGION_NAME       VARCHAR2(200),                      -- 行政区划名称
    REGION_LEVEL      VARCHAR2(10),                       -- 区划层级
    
    -- 字典字段(10个)
    DICT_1            VARCHAR2(50),                       -- 字典字段1
    DICT_2            VARCHAR2(50),                       -- 字典字段2
    DICT_3            VARCHAR2(50),                       -- 字典字段3
    DICT_4            VARCHAR2(50),                       -- 字典字段4
    DICT_5            VARCHAR2(50),                       -- 字典字段5
    DICT_6            VARCHAR2(50),                       -- 字典字段6
    DICT_7            VARCHAR2(50),                       -- 字典字段7
    DICT_8            VARCHAR2(50),                       -- 字典字段8
    DICT_9            VARCHAR2(50),                       -- 字典字段9
    DICT_10           VARCHAR2(50),                       -- 字典字段10
    
    -- 数字字段(5个)
    NUM_1             NUMBER(20,2),                       -- 数字字段1
    NUM_2             NUMBER(20,2),                       -- 数字字段2
    NUM_3             NUMBER(20,2),                       -- 数字字段3
    NUM_4             NUMBER(20,2),                       -- 数字字段4
    NUM_5             NUMBER(20,2),                       -- 数字字段5
    
    -- 日期字段(5个)
    DATE_1            DATE,                               -- 日期字段1
    DATE_2            DATE,                               -- 日期字段2
    DATE_3            DATE,                               -- 日期字段3
    DATE_4            DATE,                               -- 日期字段4
    DATE_5            DATE,                               -- 日期字段5
    
    -- 注销标识
    ZXBS              VARCHAR2(1) DEFAULT '0' NOT NULL,   -- 注销状态: 0-未注销 1-已注销
    ZXR_USER_GMSFHM   VARCHAR2(18),                       -- 注销人身份证号
    ZXR_USERNAME      VARCHAR2(30),                       -- 注销人姓名
    ZXDW              VARCHAR2(12),                       -- 注销机构
    ZXSJ              VARCHAR2(14),                       -- 注销时间
    ZXYY              VARCHAR2(500),                      -- 注销原因
    
    -- 系统字段
    CREATE_USER_GMSFHM VARCHAR2(18) NOT NULL,             -- 采集人身份证号
    CREATE_USERNAME   VARCHAR2(50) NOT NULL,              -- 采集人姓名
    CREATE_TIME       VARCHAR2(14) NOT NULL,              -- 采集时间
    CREATE_ORG_ID     VARCHAR2(12) NOT NULL,              -- 采集人机构
    UPDATE_USER_GMSFHM VARCHAR2(18) NOT NULL,             -- 操作人身份证号
    UPDATE_USERNAME   VARCHAR2(50) NOT NULL,              -- 操作人姓名
    UPDATE_TIME       VARCHAR2(14) NOT NULL,              -- 操作时间
    UPDATE_ORG_ID     VARCHAR2(12) NOT NULL,              -- 操作人机构
    MEMO              VARCHAR2(500),                      -- 备注
    
    CONSTRAINT FK_DATA_FORM FOREIGN KEY (FORM_ID) REFERENCES SYS_FORM_CONFIG(ID)
);

-- 索引
CREATE INDEX IDX_DATA_FORM ON BIZ_DATA_COMMON(FORM_ID);
CREATE INDEX IDX_DATA_ORG ON BIZ_DATA_COMMON(ORG_ID);
CREATE INDEX IDX_DATA_ZXBS ON BIZ_DATA_COMMON(ZXBS);
CREATE INDEX IDX_DATA_REGION ON BIZ_DATA_COMMON(REGION_ID);
-- 预留字段索引(根据实际使用情况创建)
CREATE INDEX IDX_DATA_FIELD1 ON BIZ_DATA_COMMON(FIELD_1);
CREATE INDEX IDX_DATA_DICT1 ON BIZ_DATA_COMMON(DICT_1);
CREATE INDEX IDX_DATA_DATE1 ON BIZ_DATA_COMMON(DATE_1);

-- 注释
COMMENT ON TABLE BIZ_DATA_COMMON IS '通用业务数据表(支持动态字段映射和分表)';
COMMENT ON COLUMN BIZ_DATA_COMMON.DATA_JSON IS '完整数据JSON';
COMMENT ON COLUMN BIZ_DATA_COMMON.FIELD_1 IS '预留字段1(可映射任意字符串类型字段)';
COMMENT ON COLUMN BIZ_DATA_COMMON.ORG_ID IS '机构ID(用于机构字段映射)';
COMMENT ON COLUMN BIZ_DATA_COMMON.DICT_1 IS '字典字段1(用于字典类型字段映射)';
COMMENT ON COLUMN BIZ_DATA_COMMON.NUM_1 IS '数字字段1(用于数值类型字段映射)';
COMMENT ON COLUMN BIZ_DATA_COMMON.DATE_1 IS '日期字段1(用于日期类型字段映射)';
```

**数据示例**:
```sql
INSERT INTO BIZ_DATA_COMMON (
    ID, FORM_ID, ORG_ID, DATA_JSON, 
    CHECK_TIME, CHECKER, CHECK_RESULT
) VALUES (
    'DATA001', 'FORM001', 'ORG001',
    '{"checkTime":"2025-11-25","checker":"张三","checkTarget":"李四","checkResult":"合格","remark":"无异常"}',
    TO_DATE('2025-11-25', 'YYYY-MM-DD'), '张三', '合格'
);
```

**说明**:
- `DATA_JSON`: 存储完整的表单数据
- 动态映射字段: 根据`SYS_FORM_FIELD_CONFIG`中配置的`IS_INDEX_FIELD='true'`的字段,通过存储过程或程序动态添加列

---

#### 2.2.2 统计底数表 (STAT_BASE_DATA)
按字段维度记录统计底数,支持灵活的指标类型扩展。

**设计思想**:
传统设计按机构、日期维度存储,每个业务一行,所有指标作为列。这种设计的问题是:
1. 新增业务需要添加列,表结构变化频繁
2. 不同业务的字段差异大,大量字段为NULL
3. 复杂指标(如比率、平均值)难以扩展

**新设计**按字段维度存储,每个指标一行,支持多种值类型:
- `count`: 计数类型(如总数)
- `avg`: 平均值类型(如平均耗时)
- `rate`: 比率类型(如核查率,需要分子分母)
- `sum`: 求和类型(如金额总计)
- `综合`: 综合指标(需要多个值计算)

```sql
CREATE TABLE STAT_BASE_DATA (
    ID                VARCHAR2(32) PRIMARY KEY,           -- 主键ID
    FORM_ID           VARCHAR2(32) NOT NULL,              -- 表单ID
    FORM_ITEM_ID      VARCHAR2(32) NOT NULL,              -- 表单项ID(字段ID)
    STAT_DATE         VARCHAR2(8) NOT NULL,               -- 统计日期(YYYYMMDD)
    ORG_ID            VARCHAR2(12) NOT NULL,              -- 机构ID
    
    -- 值类型及数据
    VALUE_TYPE        VARCHAR2(20) NOT NULL,              -- 值类型: count/avg/rate/sum/composite
    VALUE_1           NUMBER(20,4),                       -- 主值(计数/平均/比率结果/求和)
    VALUE_2           NUMBER(20,4),                       -- 辅助值1(比率分子/综合指标值2)
    VALUE_3           NUMBER(20,4),                       -- 辅助值2(比率分母/综合指标值3)
    VALUE_TEXT        VARCHAR2(500),                      -- 文本值(特殊情况)
    VALUE_JSON        CLOB,                               -- JSON值(复杂指标)
    
    -- 统计元信息
    DATA_SOURCE       VARCHAR2(20) DEFAULT 'AUTO',        -- 数据来源: AUTO-自动计算/MANUAL-手动录入
    STAT_PERIOD       VARCHAR2(10) DEFAULT 'day',         -- 统计周期: day/week/month/quarter/year
    REMARK            VARCHAR2(500),                      -- 备注说明
    
    -- 系统字段
    CREATE_USER_GMSFHM VARCHAR2(18),                      -- 创建人身份证号
    CREATE_USERNAME   VARCHAR2(50),                       -- 创建人姓名
    CREATE_TIME       VARCHAR2(14),                       -- 创建时间
    UPDATE_USER_GMSFHM VARCHAR2(18),                      -- 更新人身份证号
    UPDATE_USERNAME   VARCHAR2(50),                       -- 更新人姓名
    UPDATE_TIME       VARCHAR2(14),                       -- 更新时间
    
    CONSTRAINT FK_STAT_FORM FOREIGN KEY (FORM_ID) REFERENCES SYS_FORM_CONFIG(ID),
    CONSTRAINT UK_STAT_BASE UNIQUE (FORM_ID, FORM_ITEM_ID, STAT_DATE, ORG_ID, VALUE_TYPE)
);

-- 索引
CREATE INDEX IDX_STAT_FORM ON STAT_BASE_DATA(FORM_ID);
CREATE INDEX IDX_STAT_ITEM ON STAT_BASE_DATA(FORM_ITEM_ID);
CREATE INDEX IDX_STAT_DATE ON STAT_BASE_DATA(STAT_DATE);
CREATE INDEX IDX_STAT_ORG ON STAT_BASE_DATA(ORG_ID);
CREATE INDEX IDX_STAT_TYPE ON STAT_BASE_DATA(VALUE_TYPE);
CREATE INDEX IDX_STAT_PERIOD ON STAT_BASE_DATA(STAT_PERIOD);

-- 注释
COMMENT ON TABLE STAT_BASE_DATA IS '统计底数表(按字段维度)';
COMMENT ON COLUMN STAT_BASE_DATA.FORM_ID IS '表单ID';
COMMENT ON COLUMN STAT_BASE_DATA.FORM_ITEM_ID IS '表单项ID(字段ID)';
COMMENT ON COLUMN STAT_BASE_DATA.STAT_DATE IS '统计日期(YYYYMMDD格式)';
COMMENT ON COLUMN STAT_BASE_DATA.VALUE_TYPE IS '值类型:count-计数/avg-平均/rate-比率/sum-求和/composite-综合';
COMMENT ON COLUMN STAT_BASE_DATA.VALUE_1 IS '主值(根据VALUE_TYPE含义不同)';
COMMENT ON COLUMN STAT_BASE_DATA.VALUE_2 IS '辅助值1(如比率的分子)';
COMMENT ON COLUMN STAT_BASE_DATA.VALUE_3 IS '辅助值2(如比率的分母)';
COMMENT ON COLUMN STAT_BASE_DATA.STAT_PERIOD IS '统计周期:day/week/month/quarter/year';
```

**VALUE_TYPE说明**:

| 类型      | VALUE_1含义 | VALUE_2含义 | VALUE_3含义 | 示例                             |
| --------- | ----------- | ----------- | ----------- | -------------------------------- |
| count     | 计数结果    | -           | -           | 总数:500                         |
| avg       | 平均值      | -           | -           | 平均耗时:2.5小时                 |
| rate      | 比率结果(%) | 分子        | 分母        | 核查率:95.5% (分子:477 分母:500) |
| sum       | 求和结果    | -           | -           | 总金额:100000                    |
| composite | 综合值1     | 综合值2     | 综合值3     | 多维指标                         |

**示例数据**:
```sql
-- 实有人口总数(计数类型)
INSERT INTO STAT_BASE_DATA (
    ID, FORM_ID, FORM_ITEM_ID, STAT_DATE, ORG_ID,
    VALUE_TYPE, VALUE_1, VALUE_2, VALUE_3,
    DATA_SOURCE, STAT_PERIOD,
    CREATE_USER_GMSFHM, CREATE_USERNAME, CREATE_TIME
) VALUES (
    'STAT001', 'FORM_POPULATION', 'ITEM_TOTAL', '20251125', 'ORG001',
    'count', 500, NULL, NULL,
    'AUTO', 'day',
    '110101199001011234', '系统管理员', '20251125020000'
);

-- 核查率(比率类型,需要分子分母)
INSERT INTO STAT_BASE_DATA (
    ID, FORM_ID, FORM_ITEM_ID, STAT_DATE, ORG_ID,
    VALUE_TYPE, VALUE_1, VALUE_2, VALUE_3,
    DATA_SOURCE, STAT_PERIOD,
    CREATE_USER_GMSFHM, CREATE_USERNAME, CREATE_TIME
) VALUES (
    'STAT002', 'FORM_POPULATION', 'ITEM_CHECK_RATE', '20251125', 'ORG001',
    'rate', 95.4, 477, 500,  -- 95.4% = 477/500*100
    'AUTO', 'day',
    '110101199001011234', '系统管理员', '20251125020000'
);

-- 平均抽查耗时(平均值类型)
INSERT INTO STAT_BASE_DATA (
    ID, FORM_ID, FORM_ITEM_ID, STAT_DATE, ORG_ID,
    VALUE_TYPE, VALUE_1, VALUE_2, VALUE_3,
    DATA_SOURCE, STAT_PERIOD,
    CREATE_USER_GMSFHM, CREATE_USERNAME, CREATE_TIME
) VALUES (
    'STAT003', 'FORM_CHECK', 'ITEM_AVG_TIME', '20251125', 'ORG001',
    'avg', 2.5, NULL, NULL,  -- 平均2.5小时
    'AUTO', 'day',
    '110101199001011234', '系统管理员', '20251125020000'
);

-- 月度统计(周期为month)
INSERT INTO STAT_BASE_DATA (
    ID, FORM_ID, FORM_ITEM_ID, STAT_DATE, ORG_ID,
    VALUE_TYPE, VALUE_1, VALUE_2, VALUE_3,
    DATA_SOURCE, STAT_PERIOD,
    CREATE_USER_GMSFHM, CREATE_USERNAME, CREATE_TIME
) VALUES (
    'STAT004', 'FORM_POPULATION', 'ITEM_TOTAL', '20251101', 'ORG001',
    'count', 15230, NULL, NULL,  -- 11月总计
    'AUTO', 'month',
    '110101199001011234', '系统管理员', '20251201020000'
);
```

**查询示例**:
```sql
-- 查询某机构某日的所有统计数据
SELECT 
    f.FORM_NAME,
    fi.ITEM_LABEL AS FIELD_NAME,
    s.VALUE_TYPE,
    s.VALUE_1,
    s.VALUE_2,
    s.VALUE_3
FROM STAT_BASE_DATA s
LEFT JOIN SYS_FORM_CONFIG f ON s.FORM_ID = f.ID
LEFT JOIN SYS_FORM_ITEM_CONFIG fi ON s.FORM_ITEM_ID = fi.ID
WHERE s.ORG_ID = 'ORG001'
AND s.STAT_DATE = '20251125'
AND s.STAT_PERIOD = 'day'
ORDER BY f.FORM_NAME, fi.ITEM_ORDER;

-- 查询核查率趋势(最近7天)
SELECT 
    STAT_DATE,
    VALUE_1 AS RATE,
    VALUE_2 AS CHECKED_COUNT,
    VALUE_3 AS TOTAL_COUNT
FROM STAT_BASE_DATA
WHERE FORM_ID = 'FORM_POPULATION'
AND FORM_ITEM_ID = 'ITEM_CHECK_RATE'
AND ORG_ID = 'ORG001'
AND VALUE_TYPE = 'rate'
AND STAT_DATE >= '20251118'
AND STAT_DATE <= '20251125'
ORDER BY STAT_DATE;
```

---

### 2.3 系统管理模块

#### 2.3.1 机构表 (SYS_ORG)
存储机构信息(如果系统中已有,可复用)。

```sql
CREATE TABLE SYS_ORG (
    ID                VARCHAR2(32) PRIMARY KEY,           -- 机构ID
    PARENT_ID         VARCHAR2(32),                       -- 父机构ID
    ORG_CODE          VARCHAR2(100) NOT NULL UNIQUE,      -- 机构编码
    ORG_NAME          VARCHAR2(200) NOT NULL,             -- 机构名称
    ORG_TYPE          VARCHAR2(50),                       -- 机构类型
    SORT_NUM          NUMBER(10) DEFAULT 0,               -- 排序
    STATUS            VARCHAR2(10) DEFAULT '1',           -- 状态
    CREATE_TIME       DATE DEFAULT SYSDATE,               -- 创建时间
    CONSTRAINT FK_ORG_PARENT FOREIGN KEY (PARENT_ID) REFERENCES SYS_ORG(ID)
);

CREATE INDEX IDX_ORG_PARENT ON SYS_ORG(PARENT_ID);
COMMENT ON TABLE SYS_ORG IS '机构表';
```

---

#### 2.3.2 配置变更日志表 (SYS_CONFIG_LOG)
记录配置变更历史。

```sql
CREATE TABLE SYS_CONFIG_LOG (
    ID                VARCHAR2(32) PRIMARY KEY,           -- 主键ID
    CONFIG_TYPE       VARCHAR2(50) NOT NULL,              -- 配置类型: COLUMN/FORM/FIELD
    CONFIG_ID         VARCHAR2(32) NOT NULL,              -- 配置项ID
    OPERATE_TYPE      VARCHAR2(20) NOT NULL,              -- 操作类型: ADD/UPDATE/DELETE
    OLD_VALUE         CLOB,                               -- 旧值(JSON)
    NEW_VALUE         CLOB,                               -- 新值(JSON)
    OPERATE_BY        VARCHAR2(64),                       -- 操作人
    OPERATE_TIME      DATE DEFAULT SYSDATE,               -- 操作时间
    REMARK            VARCHAR2(500)                       -- 备注
);

CREATE INDEX IDX_LOG_CONFIG ON SYS_CONFIG_LOG(CONFIG_TYPE, CONFIG_ID);
CREATE INDEX IDX_LOG_TIME ON SYS_CONFIG_LOG(OPERATE_TIME);
COMMENT ON TABLE SYS_CONFIG_LOG IS '配置变更日志表';
```

---

## 🔧 存储过程设计

### 3.1 动态添加数据列存储过程

当配置新的索引字段时,自动为`BIZ_DATA_COMMON`表添加列。

```sql
CREATE OR REPLACE PROCEDURE SP_ADD_DATA_COLUMN(
    P_COLUMN_NAME   IN VARCHAR2,    -- 列名
    P_DATA_TYPE     IN VARCHAR2,    -- 数据类型: VARCHAR2/NUMBER/DATE/CLOB
    P_COLUMN_LENGTH IN NUMBER DEFAULT 100,  -- 列长度(VARCHAR2类型)
    P_RESULT        OUT VARCHAR2    -- 返回结果
) AS
    V_SQL           VARCHAR2(4000);
    V_COUNT         NUMBER;
    V_TYPE_DEF      VARCHAR2(100);
BEGIN
    -- 检查列是否已存在
    SELECT COUNT(*)
    INTO V_COUNT
    FROM USER_TAB_COLUMNS
    WHERE TABLE_NAME = 'BIZ_DATA_COMMON'
    AND COLUMN_NAME = UPPER(P_COLUMN_NAME);
    
    IF V_COUNT > 0 THEN
        P_RESULT := 'COLUMN_EXISTS';
        RETURN;
    END IF;
    
    -- 构建数据类型定义
    CASE P_DATA_TYPE
        WHEN 'VARCHAR2' THEN V_TYPE_DEF := 'VARCHAR2(' || P_COLUMN_LENGTH || ')';
        WHEN 'NUMBER' THEN V_TYPE_DEF := 'NUMBER(20,2)';
        WHEN 'DATE' THEN V_TYPE_DEF := 'DATE';
        WHEN 'CLOB' THEN V_TYPE_DEF := 'CLOB';
        ELSE V_TYPE_DEF := 'VARCHAR2(100)';
    END CASE;
    
    -- 动态添加列
    V_SQL := 'ALTER TABLE BIZ_DATA_COMMON ADD ' || P_COLUMN_NAME || ' ' || V_TYPE_DEF;
    EXECUTE IMMEDIATE V_SQL;
    
    -- 创建索引
    V_SQL := 'CREATE INDEX IDX_DATA_' || P_COLUMN_NAME || ' ON BIZ_DATA_COMMON(' || P_COLUMN_NAME || ')';
    EXECUTE IMMEDIATE V_SQL;
    
    P_RESULT := 'SUCCESS';
    
EXCEPTION
    WHEN OTHERS THEN
        P_RESULT := 'ERROR:' || SQLERRM;
END;
/
```

---

### 3.2 统计数据计算存储过程

定时任务调用,生成每日统计底数。

```sql
CREATE OR REPLACE PROCEDURE SP_CALC_DAILY_STAT(
    P_STAT_DATE IN DATE,        -- 统计日期
    P_ORG_ID    IN VARCHAR2,    -- 机构ID (NULL表示全部)
    P_RESULT    OUT VARCHAR2    -- 返回结果
) AS
    V_COUNT     NUMBER;
BEGIN
    -- 删除当日旧数据(如果存在)
    DELETE FROM STAT_DAILY_BASE 
    WHERE STAT_DATE = P_STAT_DATE
    AND (P_ORG_ID IS NULL OR ORG_ID = P_ORG_ID);
    
    -- 计算实有人口统计
    INSERT INTO STAT_DAILY_BASE (
        ID, ORG_ID, STAT_DATE, CATEGORY,
        POPULATION_TOTAL, POPULATION_INSPECT_TOTAL, POPULATION_INSPECT_FAIL
    )
    SELECT 
        SYS_GUID() AS ID,
        ORG_ID,
        P_STAT_DATE AS STAT_DATE,
        'POPULATION' AS CATEGORY,
        COUNT(*) AS POPULATION_TOTAL,
        SUM(CASE WHEN CHECK_TIME IS NOT NULL THEN 1 ELSE 0 END) AS POPULATION_INSPECT_TOTAL,
        SUM(CASE WHEN CHECK_RESULT = '不合格' THEN 1 ELSE 0 END) AS POPULATION_INSPECT_FAIL
    FROM BIZ_DATA_COMMON
    WHERE FORM_ID = 'FORM001'  -- 根据实际表单ID调整
    AND STATUS = '1'
    AND (P_ORG_ID IS NULL OR ORG_ID = P_ORG_ID)
    GROUP BY ORG_ID;
    
    -- 更新核查率等计算字段
    UPDATE STAT_DAILY_BASE
    SET POPULATION_CHECK_RATE = CASE 
        WHEN POPULATION_TOTAL > 0 THEN 
            ROUND(POPULATION_INSPECT_TOTAL / POPULATION_TOTAL * 100, 2)
        ELSE 0 
    END
    WHERE STAT_DATE = P_STAT_DATE
    AND CATEGORY = 'POPULATION'
    AND (P_ORG_ID IS NULL OR ORG_ID = P_ORG_ID);
    
    COMMIT;
    P_RESULT := 'SUCCESS';
    
EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        P_RESULT := 'ERROR:' || SQLERRM;
END;
/
```

---

### 3.3 数据查询存储过程 (动态SQL)

根据表单配置动态构建查询条件。

```sql
CREATE OR REPLACE PROCEDURE SP_QUERY_DATA(
    P_FORM_ID       IN VARCHAR2,        -- 表单ID
    P_ORG_ID        IN VARCHAR2,        -- 机构ID
    P_QUERY_JSON    IN CLOB,            -- 查询条件(JSON格式)
    P_PAGE_NUM      IN NUMBER,          -- 页码
    P_PAGE_SIZE     IN NUMBER,          -- 每页大小
    P_RESULT        OUT SYS_REFCURSOR   -- 返回结果集
) AS
    V_SQL           VARCHAR2(4000);
    V_WHERE         VARCHAR2(2000);
BEGIN
    -- 基础SQL
    V_SQL := 'SELECT * FROM BIZ_DATA_COMMON WHERE FORM_ID = :FORM_ID AND STATUS = ''1''';
    
    -- 机构条件
    IF P_ORG_ID IS NOT NULL THEN
        V_SQL := V_SQL || ' AND ORG_ID = :ORG_ID';
    END IF;
    
    -- 动态查询条件(简化示例,实际需要解析JSON并构建条件)
    -- 这里可以根据 P_QUERY_JSON 动态添加 WHERE 条件
    
    -- 分页
    V_SQL := 'SELECT * FROM (' || V_SQL || ') WHERE ROWNUM <= :END_ROW';
    
    -- 执行查询
    OPEN P_RESULT FOR V_SQL USING P_FORM_ID, P_ORG_ID, (P_PAGE_NUM * P_PAGE_SIZE);
    
EXCEPTION
    WHEN OTHERS THEN
        RAISE;
END;
/
```

---

## 📊 视图设计

### 4.1 列配置树形视图

方便前端查询树形结构。

```sql
CREATE OR REPLACE VIEW V_COLUMN_TREE AS
WITH RECURSIVE COLUMN_TREE AS (
    -- 根节点
    SELECT 
        ID, PARENT_ID, LABEL, PROP, COLUMN_WIDTH, ALIGN, 
        FIXED, DEFAULT_EXPAND, FORM_ID, SORT_NUM,
        1 AS LEVEL,
        CAST(SORT_NUM AS VARCHAR2(4000)) AS PATH
    FROM SYS_COLUMN_CONFIG
    WHERE PARENT_ID IS NULL AND STATUS = '1'
    
    UNION ALL
    
    -- 子节点
    SELECT 
        C.ID, C.PARENT_ID, C.LABEL, C.PROP, C.COLUMN_WIDTH, C.ALIGN,
        C.FIXED, C.DEFAULT_EXPAND, C.FORM_ID, C.SORT_NUM,
        T.LEVEL + 1,
        T.PATH || '/' || CAST(C.SORT_NUM AS VARCHAR2(4000))
    FROM SYS_COLUMN_CONFIG C
    INNER JOIN COLUMN_TREE T ON C.PARENT_ID = T.ID
    WHERE C.STATUS = '1'
)
SELECT * FROM COLUMN_TREE
ORDER BY PATH;

COMMENT ON VIEW V_COLUMN_TREE IS '列配置树形视图';
```

注: Oracle 11g不支持WITH RECURSIVE,需要使用`CONNECT BY`改写:

```sql
CREATE OR REPLACE VIEW V_COLUMN_TREE AS
SELECT 
    ID, PARENT_ID, LABEL, PROP, COLUMN_WIDTH, ALIGN,
    FIXED, DEFAULT_EXPAND, FORM_ID, SORT_NUM,
    LEVEL AS LEVEL,
    SYS_CONNECT_BY_PATH(SORT_NUM, '/') AS PATH
FROM SYS_COLUMN_CONFIG
WHERE STATUS = '1'
START WITH PARENT_ID IS NULL
CONNECT BY PRIOR ID = PARENT_ID
ORDER SIBLINGS BY SORT_NUM;
```

---

### 4.2 表单完整配置视图

关联表单和字段配置。

```sql
CREATE OR REPLACE VIEW V_FORM_FULL_CONFIG AS
SELECT 
    F.ID AS FORM_ID,
    F.FORM_CODE,
    F.FORM_NAME,
    F.DATA_TABLE,
    FF.ID AS FIELD_ID,
    FF.FIELD_NAME,
    FF.FIELD_LABEL,
    FF.FIELD_TYPE,
    FF.IS_REQUIRED,
    FF.DB_COLUMN,
    FF.IS_INDEX_FIELD,
    FF.SHOW_IN_FORM,
    FF.SHOW_IN_LIST,
    FF.SHOW_IN_QUERY,
    FF.FORM_SORT
FROM SYS_FORM_CONFIG F
INNER JOIN SYS_FORM_FIELD_CONFIG FF ON F.ID = FF.FORM_ID
WHERE F.STATUS = '1' AND FF.STATUS = '1'
ORDER BY F.ID, FF.FORM_SORT;

COMMENT ON VIEW V_FORM_FULL_CONFIG IS '表单完整配置视图';
```

---

## 🔐 权限与安全

### 5.1 数据权限控制

通过机构字段实现数据隔离。

```sql
-- 创建数据权限视图(示例)
CREATE OR REPLACE VIEW V_DATA_PERMISSION AS
SELECT 
    D.*
FROM BIZ_DATA_COMMON D
WHERE D.ORG_ID IN (
    SELECT ORG_ID FROM USER_ORG_RELATION WHERE USER_ID = SYS_CONTEXT('USERENV', 'SESSION_USER')
);
```

### 5.2 SQL注入防护

- 所有动态SQL使用绑定变量
- 存储过程参数严格校验
- 后端接口参数过滤

---

## 📈 性能优化

### 6.1 索引策略
- 所有外键字段建立索引
- 查询条件字段建立索引
- 动态映射字段自动创建索引
- 定期重建索引: `ALTER INDEX idx_name REBUILD;`

### 6.2 分区策略(可选)

对于数据量大的表,可按日期分区。

```sql
-- 按月分区示例
CREATE TABLE STAT_DAILY_BASE (
    -- 字段同前
)
PARTITION BY RANGE (STAT_DATE) (
    PARTITION P202511 VALUES LESS THAN (TO_DATE('2025-12-01', 'YYYY-MM-DD')),
    PARTITION P202512 VALUES LESS THAN (TO_DATE('2026-01-01', 'YYYY-MM-DD'))
);
```

### 6.3 统计信息更新

```sql
-- 定期收集统计信息
BEGIN
    DBMS_STATS.GATHER_TABLE_STATS('SCHEMA_NAME', 'BIZ_DATA_COMMON');
    DBMS_STATS.GATHER_TABLE_STATS('SCHEMA_NAME', 'STAT_DAILY_BASE');
END;
/
```

---

## 🔄 数据迁移脚本

### 7.1 初始化脚本执行顺序

```sql
-- 1. 创建表
@01_create_tables.sql

-- 2. 创建索引
@02_create_indexes.sql

-- 3. 创建视图
@03_create_views.sql

-- 4. 创建存储过程
@04_create_procedures.sql

-- 5. 初始化数据
@05_init_data.sql
```

### 7.2 示例数据初始化

```sql
-- 初始化列配置
@data/init_column_config.sql

-- 初始化表单配置
@data/init_form_config.sql

-- 初始化机构数据
@data/init_org_data.sql
```

---

## 📝 附录

### 附录A: 字段命名规范
- 主键: `ID`
- 外键: `XXX_ID`
- 时间: `XXX_TIME`
- 状态: `STATUS`
- 排序: `SORT_NUM`
- 备注: `REMARK`

### 附录B: 数据字典

| 字典类型    | 字典值   | 说明     |
| ----------- | -------- | -------- |
| STATUS      | 1        | 启用     |
| STATUS      | 0        | 禁用     |
| FIELD_TYPE  | input    | 文本框   |
| FIELD_TYPE  | select   | 下拉框   |
| FIELD_TYPE  | date     | 日期     |
| FIELD_TYPE  | textarea | 文本域   |
| DATA_SOURCE | AUTO     | 自动计算 |
| DATA_SOURCE | MANUAL   | 手动录入 |

### 附录C: 表清单

| 序号 | 表名                 | 说明           | 数据量预估 |
| ---- | -------------------- | -------------- | ---------- |
| 1    | SYS_COLUMN_CONFIG    | 列配置表       | < 1000     |
| 2    | SYS_FORM_CONFIG      | 表单配置表     | < 100      |
| 3    | SYS_FORM_ITEM_CONFIG | 表单组件配置表 | < 1000     |
| 4    | BIZ_DATA_COMMON      | 通用业务数据表 | 10万+      |
| 5    | STAT_DAILY_BASE      | 每日统计底数表 | 1万+       |
| 6    | SYS_ORG              | 机构表         | < 500      |
| 7    | SYS_CONFIG_LOG       | 配置变更日志表 | 1万+       |

---

**文档版本**: 1.0  
**最后更新**: 2025-11-25
