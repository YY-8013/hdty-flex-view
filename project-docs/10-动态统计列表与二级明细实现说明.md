# åŠ¨æ€ç»Ÿè®¡åˆ—è¡¨ä¸äºŒçº§æ˜ç»†å®ç°è¯´æ˜

## ä¸€ã€åŠŸèƒ½æ¦‚è¿°

æœ¬æ–‡æ¡£è¯´æ˜åŠ¨æ€ç»Ÿè®¡åˆ—è¡¨ä»¥åŠå¯ç‚¹å‡»çš„äºŒçº§æ˜ç»†åŠ¨æ€åˆ—è¡¨åŠå…¶åŠ¨æ€è¡¨å•çš„å®Œæ•´å®ç°æ–¹æ¡ˆã€‚

### 1.1 æ ¸å¿ƒåŠŸèƒ½

1. **åŠ¨æ€ç»Ÿè®¡åˆ—è¡¨**: æ ¹æ®åˆ—é…ç½®åŠ¨æ€æ¸²æŸ“å¤šå±‚çº§è¡¨æ ¼
2. **å¯ç‚¹å‡»å•å…ƒæ ¼**: é…ç½®äº† formId çš„åˆ—å¯ç‚¹å‡»æŸ¥çœ‹æ˜ç»†
3. **äºŒçº§æ˜ç»†åˆ—è¡¨**: å¼¹çª—å±•ç¤ºæ˜ç»†æ•°æ®çš„åŠ¨æ€åˆ—è¡¨
4. **åŠ¨æ€è¡¨å•**: æ”¯æŒæŸ¥è¯¢ã€æ–°å¢ã€ç¼–è¾‘çš„å®Œå…¨é…ç½®åŒ–è¡¨å•
5. **çµæ´»å¸ƒå±€**: é€šè¿‡JSONé…ç½®æ§åˆ¶è¡¨å•å¸ƒå±€(ä¸€è¡Œ1ä¸ªæˆ–2ä¸ªå­—æ®µ)

## äºŒã€é…ç½®è®¾è®¡

### 2.1 ä¸æ–°å¢æ•°æ®åº“å­—æ®µåŸåˆ™

æ‰€æœ‰æ‰©å±•é…ç½®éƒ½å­˜å‚¨åœ¨ç°æœ‰çš„JSONå­—æ®µä¸­ï¼š
- **åˆ—é…ç½®**: ä½¿ç”¨ `columnConfig` å­—æ®µ(CLOB)
- **è¡¨å•é¡¹é…ç½®**: ä½¿ç”¨ `itemConfig` å­—æ®µ(CLOB)

### 2.2 åˆ—é…ç½® JSON ç»“æ„

```json
{
  "clickable": {
    "enabled": true,
    "formId": "FORM001",
    "openType": "dialog"
  },
  "style": {
    "color": "#409EFF",
    "cursor": "pointer"
  },
  "conditional": {
    "rules": [
      {
        "condition": "value > 90",
        "style": { "color": "#67C23A" }
      }
    ]
  }
}
```

### 2.3 è¡¨å•é¡¹é…ç½® JSON ç»“æ„

```json
{
  "display": {
    "showInForm": true,
    "showInList": true,
    "showInQuery": false,
    "columnWidth": 120
  },
  "layout": {
    "span": 12,
    "labelWidth": "120px"
  },
  "validation": {
    "required": true,
    "message": "ä¸èƒ½ä¸ºç©º"
  },
  "componentProps": {
    "clearable": true,
    "filterable": true
  }
}
```

## ä¸‰ã€æ ¸å¿ƒç»„ä»¶è¯´æ˜

### 3.1 DetailDialog (äºŒçº§æ˜ç»†å¼¹çª—)

**æ–‡ä»¶è·¯å¾„**: `src/views/business/flex-view/stat/components/DetailDialog.vue`

**åŠŸèƒ½**:
- æ ¹æ® formId åŠ è½½è¡¨å•é…ç½®å’Œè¡¨å•é¡¹é…ç½®
- è§£æ itemConfig JSONï¼Œç­›é€‰å­—æ®µ:
  - `showInQuery=true` â†’ æ„å»ºæŸ¥è¯¢è¡¨å•
  - `showInForm=true` â†’ æ„å»ºæ–°å¢/ç¼–è¾‘è¡¨å•
  - `showInList=true` â†’ æ„å»ºåˆ—è¡¨åˆ—
- å®ç°å®Œæ•´çš„å¢åˆ æ”¹æŸ¥åŠŸèƒ½

**å…³é”®æ–¹æ³•**:

```javascript
// åŠ è½½è¡¨å•é…ç½®
async loadFormConfig() {
  const response = await getFormConfig({ id: this.formId });
  this.formConfig = response.data.data.vo;
}

// åŠ è½½è¡¨å•é¡¹é…ç½®å¹¶è§£æ
async loadFormItems() {
  const response = await getFormItemPage({ formId: this.formId });
  const items = response.data.data.records;
  
  // è§£ææ¯ä¸ªè¡¨å•é¡¹çš„ itemConfig
  const parsedItems = items.map(item => ({
    vo: item.vo,
    config: JSON.parse(item.vo.itemConfig)
  }));
  
  // æ ¹æ® display é…ç½®ç­›é€‰å­—æ®µ
  this.queryFields = parsedItems
    .filter(item => item.config.display?.showInQuery)
    .map(item => this.convertToFormField(item));
    
  this.formFields = parsedItems
    .filter(item => item.config.display?.showInForm !== false)
    .map(item => this.convertToFormField(item));
    
  this.detailColumns = parsedItems
    .filter(item => item.config.display?.showInList)
    .map(item => this.convertToColumn(item));
}

// è½¬æ¢ä¸ºè¡¨å•å­—æ®µé…ç½®
convertToFormField(item) {
  const config = item.config;
  return {
    prop: item.vo.itemProp,
    label: item.vo.itemLabel,
    type: item.vo.itemType,
    span: config.layout?.span || 12, // ä¸€è¡Œ2ä¸ªå­—æ®µ
    required: config.validation?.required,
    config: config
  };
}
```

### 3.2 DynamicForm (åŠ¨æ€è¡¨å•ç»„ä»¶)

**æ–‡ä»¶è·¯å¾„**: `src/views/business/flex-view/components/common/DynamicForm/index.vue`

**åŠŸèƒ½**:
- æ ¹æ® formItems é…ç½®åŠ¨æ€æ¸²æŸ“è¡¨å•
- æ”¯æŒ span æ§åˆ¶å¸ƒå±€(12=åŠè¡Œ, 24=æ•´è¡Œ)
- æ”¯æŒä¸‰ç§æ¨¡å¼: add/edit/view

**å…³é”®æ–¹æ³•**:

```javascript
// è·å–å­—æ®µå ä½
getItemSpan(item) {
  // ä¼˜å…ˆä½¿ç”¨ item.span
  if (item.span !== undefined) {
    return item.span;
  }
  
  // ä» config ä¸­è§£æ
  const config = this.parseConfig(item);
  if (config.span) {
    return config.span;
  }
  
  // ä» layout ä¸­è§£æ
  if (config.layout?.span) {
    return config.layout.span;
  }
  
  // é»˜è®¤å€¼
  return this.inline ? 8 : 12;
}
```

### 3.3 DynamicColumn (åŠ¨æ€åˆ—ç»„ä»¶)

**æ–‡ä»¶è·¯å¾„**: `src/views/business/flex-view/stat/components/DynamicColumn.vue`

**åŠŸèƒ½**:
- é€’å½’æ¸²æŸ“å¤šå±‚çº§åˆ—
- æ”¯æŒç‚¹å‡»äº‹ä»¶
- æ”¯æŒæ¡ä»¶æ ·å¼
- æ”¯æŒæ•°æ®æ ¼å¼åŒ–

**å…³é”®æ–¹æ³•**:

```javascript
// è§£æåˆ—é…ç½®
parseColumnConfig(column) {
  return typeof column.columnConfig === "string"
    ? JSON.parse(column.columnConfig)
    : column.columnConfig || {};
}

// è·å–å•å…ƒæ ¼æ ·å¼
getCellStyle(column, row) {
  const columnConfig = this.parseColumnConfig(column);
  const style = { ...columnConfig.style };
  
  // åº”ç”¨æ¡ä»¶æ ·å¼
  if (columnConfig.conditional?.rules) {
    const value = row[column.prop];
    for (const rule of columnConfig.conditional.rules) {
      if (this.evalCondition(rule.condition, value)) {
        Object.assign(style, rule.style);
        break;
      }
    }
  }
  
  return style;
}
```

### 3.4 FieldRender (å­—æ®µæ¸²æŸ“ç»„ä»¶)

**æ–‡ä»¶è·¯å¾„**: `src/views/business/flex-view/components/common/DynamicForm/FieldRender.vue`

**åŠŸèƒ½**:
- æ ¹æ® itemType æ¸²æŸ“å¯¹åº”çš„ç»„ä»¶
- æ”¯æŒå¤šç§ HDty ç»„ä»¶
- æ”¯æŒè‡ªå®šä¹‰é…ç½®ä¼ é€’

**æ”¯æŒçš„ç»„ä»¶ç±»å‹**:
- input, textarea, number
- select, radio, checkbox
- date, datetime, daterange
- dict-select, dict-radio, dict-checkbox
- organ, region

## å››ã€æ•°æ®æµè½¬æµç¨‹

### 4.1 ç»Ÿè®¡é¡µé¢ç‚¹å‡»æµç¨‹

```mermaid
graph TD
    A[ç”¨æˆ·ç‚¹å‡»ç»Ÿè®¡åˆ—å•å…ƒæ ¼] --> B[è§£æåˆ—çš„columnConfig]
    B --> C{æ˜¯å¦é…ç½®clickable?}
    C -->|æ˜¯| D[è¯»å–clickable.formId]
    C -->|å¦| E[ä½¿ç”¨column.formId]
    D --> F[æ‰“å¼€DetailDialog]
    E --> F
    F --> G[åŠ è½½è¡¨å•é…ç½®]
    G --> H[åŠ è½½è¡¨å•é¡¹é…ç½®]
    H --> I[è§£æitemConfig JSON]
    I --> J[æ„å»ºæŸ¥è¯¢è¡¨å•]
    I --> K[æ„å»ºåˆ—è¡¨åˆ—]
    I --> L[æ„å»ºæ–°å¢ç¼–è¾‘è¡¨å•]
    J --> M[å±•ç¤ºäºŒçº§æ˜ç»†å¼¹çª—]
    K --> M
    L --> M
```

### 4.2 è¡¨å•é¡¹é…ç½®è§£ææµç¨‹

```mermaid
graph TD
    A[åŠ è½½è¡¨å•é¡¹åˆ—è¡¨] --> B[è§£ææ¯ä¸ªitemConfig JSON]
    B --> C[è¯»å–displayé…ç½®]
    C --> D{showInQuery=true?}
    C --> E{showInForm=true?}
    C --> F{showInList=true?}
    D -->|æ˜¯| G[æ·»åŠ åˆ°queryFields]
    E -->|æ˜¯| H[æ·»åŠ åˆ°formFields]
    F -->|æ˜¯| I[æ·»åŠ åˆ°detailColumns]
    G --> J[æ„å»ºæŸ¥è¯¢è¡¨å•]
    H --> K[æ„å»ºæ–°å¢ç¼–è¾‘è¡¨å•]
    I --> L[æ„å»ºåˆ—è¡¨åˆ—]
```

## äº”ã€é…ç½®ç¤ºä¾‹

### 5.1 å¯ç‚¹å‡»åˆ—é…ç½®

**åˆ—é…ç½®è¡¨ (SYS_COLUMN_CONFIG)**:

| å­—æ®µ         | å€¼           |
| ------------ | ------------ |
| label        | æŠ½æŸ¥æ€»æ•°     |
| prop         | check_total  |
| columnWidth  | 100          |
| columnConfig | (è§ä¸‹æ–¹JSON) |

**columnConfig JSON**:
```json
{
  "clickable": {
    "enabled": true,
    "formId": "CHECK_FORM_001",
    "openType": "dialog",
    "dialogWidth": "80%"
  },
  "style": {
    "color": "#409EFF",
    "cursor": "pointer",
    "textDecoration": "underline"
  },
  "formatter": {
    "type": "number",
    "precision": 0
  }
}
```

### 5.2 è¡¨å•é¡¹é…ç½®ç¤ºä¾‹

#### ç¤ºä¾‹1: å§“åå­—æ®µ (ä¸€è¡Œ2ä¸ª)

**è¡¨å•é¡¹é…ç½®è¡¨ (SYS_FORM_ITEM_CONFIG)**:

| å­—æ®µ       | å€¼           |
| ---------- | ------------ |
| itemType   | input        |
| itemLabel  | å§“å         |
| itemProp   | name         |
| itemConfig | (è§ä¸‹æ–¹JSON) |

**itemConfig JSON**:
```json
{
  "placeholder": "è¯·è¾“å…¥å§“å",
  "display": {
    "showInForm": true,
    "showInList": true,
    "showInQuery": true,
    "columnWidth": 120
  },
  "layout": {
    "span": 12
  },
  "validation": {
    "required": true,
    "message": "å§“åä¸èƒ½ä¸ºç©º",
    "maxLength": 50
  },
  "componentProps": {
    "clearable": true,
    "maxlength": 50
  }
}
```

#### ç¤ºä¾‹2: å¤‡æ³¨å­—æ®µ (ç‹¬å ä¸€è¡Œ)

```json
{
  "placeholder": "è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯",
  "display": {
    "showInForm": true,
    "showInList": false,
    "showInQuery": false
  },
  "layout": {
    "span": 24
  },
  "componentProps": {
    "rows": 3,
    "maxlength": 500,
    "showWordLimit": true
  }
}
```

#### ç¤ºä¾‹3: å­—å…¸é€‰æ‹©å­—æ®µ

```json
{
  "placeholder": "è¯·é€‰æ‹©çŠ¶æ€",
  "display": {
    "showInForm": true,
    "showInList": true,
    "showInQuery": true,
    "columnWidth": 100
  },
  "layout": {
    "span": 12
  },
  "validation": {
    "required": true
  },
  "componentProps": {
    "dictCode": "ZXBS",
    "filterable": true
  },
  "listFormatter": {
    "type": "dict",
    "dictCode": "ZXBS"
  }
}
```

## å…­ã€ä½¿ç”¨æŒ‡å—

### 6.1 é…ç½®å¯ç‚¹å‡»åˆ—

1. åœ¨åˆ—é…ç½®ç®¡ç†ä¸­ï¼Œæ‰¾åˆ°éœ€è¦é…ç½®çš„åˆ—
2. ç¼–è¾‘ columnConfig å­—æ®µï¼Œæ·»åŠ  clickable é…ç½®:
```json
{
  "clickable": {
    "enabled": true,
    "formId": "ä½ çš„è¡¨å•ID"
  },
  "style": {
    "color": "#409EFF",
    "cursor": "pointer"
  }
}
```

### 6.2 é…ç½®è¡¨å•é¡¹å¸ƒå±€

1. åœ¨è¡¨å•é¡¹é…ç½®ç®¡ç†ä¸­ï¼Œç¼–è¾‘ itemConfig
2. è®¾ç½® layout.span:
   - span=12: ä¸€è¡Œæ˜¾ç¤º2ä¸ªå­—æ®µ
   - span=24: ç‹¬å ä¸€è¡Œ

### 6.3 é…ç½®æ˜¾ç¤ºæ§åˆ¶

åœ¨ itemConfig çš„ display é…ç½®ä¸­:
```json
{
  "display": {
    "showInForm": true,    // åœ¨è¡¨å•ä¸­æ˜¾ç¤º
    "showInList": true,     // åœ¨åˆ—è¡¨ä¸­æ˜¾ç¤º
    "showInQuery": false,   // ä½œä¸ºæŸ¥è¯¢æ¡ä»¶
    "columnWidth": 120      // åˆ—è¡¨åˆ—å®½
  }
}
```

## ä¸ƒã€æ³¨æ„äº‹é¡¹

1. **JSONæ ¼å¼**: æ‰€æœ‰é…ç½®å¿…é¡»æ˜¯åˆæ³•çš„JSONæ ¼å¼
2. **å‘åå…¼å®¹**: æœªé…ç½®çš„å­—æ®µä½¿ç”¨é»˜è®¤å€¼ï¼Œä¸å½±å“æ—§æ•°æ®
3. **formIdå…³è”**: ç¡®ä¿ clickable.formId å¯¹åº”çš„è¡¨å•å·²é…ç½®
4. **å­—æ®µæ˜ å°„**: è¡¨å•é¡¹çš„ tableKey è¦ä¸æ•°æ®åº“å­—æ®µå¯¹åº”
5. **å­—å…¸ç¼–ç **: dictCode è¦ä¸ç³»ç»Ÿå­—å…¸ç±»å‹ä¸€è‡´

## å…«ã€å¸¸è§é—®é¢˜

### Q1: åˆ—ç‚¹å‡»æ²¡ååº”?
**A**: æ£€æŸ¥ columnConfig ä¸­çš„ clickable.enabled æ˜¯å¦ä¸º trueï¼ŒformId æ˜¯å¦æ­£ç¡®

### Q2: è¡¨å•å­—æ®µä¸æ˜¾ç¤º?
**A**: æ£€æŸ¥ itemConfig ä¸­çš„ display.showInForm é…ç½®

### Q3: è¡¨å•å¸ƒå±€ä¸å¯¹?
**A**: æ£€æŸ¥ layout.span é…ç½®ï¼Œ12=åŠè¡Œï¼Œ24=æ•´è¡Œ

### Q4: å­—å…¸ä¸æ˜¾ç¤º?
**A**: æ£€æŸ¥ componentProps.dictCode æ˜¯å¦ä¸ç³»ç»Ÿå­—å…¸ç±»å‹ä¸€è‡´

### Q5: åˆ—è¡¨åˆ—ä¸æ˜¾ç¤º?
**A**: æ£€æŸ¥ display.showInList æ˜¯å¦ä¸º true

## ä¹ã€åç»­ä¼˜åŒ–æ–¹å‘

1. âœ… æ”¯æŒæ¡ä»¶æ ·å¼
2. âœ… æ”¯æŒæ•°æ®æ ¼å¼åŒ–
3. âœ… æ”¯æŒçµæ´»å¸ƒå±€
4. ğŸ”² æ”¯æŒå­—æ®µè”åŠ¨
5. ğŸ”² æ”¯æŒæ¡ä»¶æ˜¾ç¤º/éšè—
6. ğŸ”² æ”¯æŒè‡ªå®šä¹‰æ ¡éªŒå™¨
7. ğŸ”² æ”¯æŒæ‰¹é‡å¯¼å…¥/å¯¼å‡º

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-12-02  
**ç»´æŠ¤äººå‘˜**: AIåŠ©æ‰‹
