# 数据晾晒模块 - 组件初始化清单

## 📋 文档说明

本文档记录了 flex-view 模块的组件初始化情况，所有组件均已创建基本框架，待后续开发具体逻辑。

**创建时间**: 2025-11-26  
**最后更新**: 2025-11-26  
**状态**: ✅ 基础框架已完成（已按照HDty规范更新布局）

---

## 📁 已创建组件清单

### 一、统计展示模块 (`stat/`)

#### 1.1 统计列表主页

**文件**: `src/views/business/flex-view/stat/index.vue`

**功能**: 数据晾晒统计列表主页

**特点**:
- ✅ 个性化实现，**不使用 DynamicTable**（会有更多个性化改动）
- ✅ 集成查询、表格、明细弹窗三大模块
- ✅ Vuex 状态管理集成

**待开发**:
- [ ] 初始化逻辑（加载列配置、统计数据）
- [ ] 查询功能实现
- [ ] 单元格点击逻辑
- [ ] 分页逻辑

---

#### 1.2 统计查询组件

**文件**: `src/views/business/flex-view/stat/components/StatQuery.vue`

**功能**: 统计列表的查询条件组件

**特点**:
- ✅ 基于 `el-form` 实现
- ✅ 动态渲染查询字段
- ✅ 支持多种字段类型

**待开发**:
- [ ] 字段组件映射完善
- [ ] HDty 组件集成（日期、机构、地区等）
- [ ] 查询参数收集逻辑

---

#### 1.3 统计表格组件

**文件**: `src/views/business/flex-view/stat/components/StatTable.vue`

**功能**: 统计列表的表格展示组件（**个性化实现**）

**特点**:
- ✅ 基于 `el-table` 自研
- ✅ 支持多级表头（二级）
- ✅ 固定列（机构、总数）
- ✅ 单元格点击事件
- ✅ 分页功能

**待开发**:
- [ ] 多级表头递归渲染（三级及以上）
- [ ] 单元格格式化逻辑
- [ ] 单元格样式和类名计算
- [ ] 表格高度自适应

---

#### 1.4 明细数据弹窗

**文件**: `src/views/business/flex-view/stat/components/DetailDialog.vue`

**功能**: 点击统计单元格后弹出的明细数据弹窗

**特点**:
- ✅ 集成 **DynamicTable**（明细列表）
- ✅ 集成 **DynamicForm**（新增/编辑表单）
- ✅ 支持新增、编辑、删除操作
- ✅ 嵌套弹窗（列表弹窗 + 表单弹窗）

**待开发**:
- [ ] 表单配置加载逻辑
- [ ] 明细列配置生成
- [ ] 明细数据加载
- [ ] 新增/编辑/删除逻辑
- [ ] 数据提交与刷新

---

### 二、通用组件 (`components/common/`)

#### 2.1 动态表格组件 (DynamicTable)

**文件**: `src/views/business/flex-view/components/common/DynamicTable/index.vue`

**功能**: 基于配置动态渲染的表格组件

**⚠️ 使用场景**: **二级明细列表**（不用于统计列表页）

**特点**:
- ✅ 基于 `el-table` 自研
- ✅ 完全配置驱动
- ✅ 支持多选、序号列
- ✅ 支持操作列（编辑、删除）
- ✅ 支持自定义插槽
- ✅ 支持分页

**待开发**:
- [ ] 单元格值格式化（日期、数字、字典翻译）
- [ ] 自定义格式化函数支持
- [ ] 更多列类型支持

---

#### 2.2 动态表单组件 (DynamicForm)

**文件**: `src/views/business/flex-view/components/common/DynamicForm/index.vue`

**功能**: 基于配置动态渲染的表单组件

**⚠️ 使用场景**: **明细数据新增/编辑表单**

**特点**:
- ✅ 基于 `el-form` 自研
- ✅ 完全配置驱动
- ✅ 支持表单验证
- ✅ 支持三种模式（add/edit/view）
- ✅ 支持栅格布局

**待开发**:
- [ ] 字段联动逻辑
- [ ] 更多验证规则
- [ ] 表单分组支持

---

#### 2.3 字段渲染器 (FieldRender)

**文件**: `src/views/business/flex-view/components/common/DynamicForm/FieldRender.vue`

**功能**: 根据字段类型渲染对应组件（**复用 HDty 组件**）

**特点**:
- ✅ 支持基础字段（input、textarea、number、select 等）
- ✅ 预留 HDty 组件接口（待集成）
- ✅ 支持字段配置

**待开发**:
- [ ] HDty 组件导入和注册
  - `hd-date-picker` - 日期选择
  - `hd-organ` - 机构选择
  - `hd-region` - 地区选择
  - `hd-dict-select` - 字典下拉选择
  - `hd-dict-cascader` - 字典级联选择
  - `hd-dict-checkbox` - 字典多选框
  - `hd-dict-radio` - 字典单选框
- [ ] 字段配置完善（placeholder、disabled、readonly 等）

---

### 三、配置管理模块 (`config/`)

#### 3.1 列配置管理页

**文件**: `src/views/business/flex-view/config/column/index.vue`

**功能**: 管理统计列配置

**待开发**:
- [ ] 列树形编辑器
- [ ] 列属性编辑器
- [ ] 列配置保存/加载
- [ ] 列配置预览

---

#### 3.2 表单配置列表页

**文件**: `src/views/business/flex-view/config/form/index.vue`

**功能**: 管理表单配置列表

**待开发**:
- [ ] 表单配置列表展示
- [ ] 表单配置增删改查
- [ ] 跳转到表单编辑页

---

#### 3.3 表单配置编辑页

**文件**: `src/views/business/flex-view/config/form/form-edit.vue`

**功能**: 编辑表单配置

**待开发**:
- [ ] 表单基本信息编辑
- [ ] 表单项列表管理
- [ ] 表单项属性编辑
- [ ] 表单配置保存

---

## 🎯 组件关系图

```
统计列表主页 (stat/index.vue)
│
├── 统计查询组件 (StatQuery.vue)
│   └── 动态渲染查询字段
│
├── 统计表格组件 (StatTable.vue) ⚠️ 个性化实现
│   ├── 多级表头渲染
│   ├── 固定列
│   └── 单元格点击事件
│
└── 明细数据弹窗 (DetailDialog.vue)
    ├── DynamicTable 🔄 明细列表
    │   ├── 支持编辑/删除操作
    │   └── 分页功能
    │
    └── DynamicForm 🔄 新增/编辑表单
        └── FieldRender 🔄 字段渲染器
            ├── 基础组件 (el-input, el-select...)
            └── HDty 组件 (hd-date-picker, hd-organ...)
```

---

## 📊 开发优先级

### P0 - 核心功能（第1周）

1. **字段渲染器 (FieldRender)** - HDty 组件集成
   - 导入和注册 HDty 组件
   - 配置字段类型映射
   - 测试各字段类型

2. **动态表单 (DynamicForm)** - 基本功能
   - 验证规则完善
   - 表单提交逻辑
   - 测试表单验证

3. **动态表格 (DynamicTable)** - 基本功能
   - 单元格格式化
   - 操作列功能
   - 测试分页和排序

---

### P1 - 页面开发（第2周）

4. **统计列表页 (stat/index.vue)**
   - 加载列配置和统计数据
   - 查询功能实现
   - 单元格点击逻辑

5. **明细弹窗 (DetailDialog.vue)**
   - 明细数据加载
   - 新增/编辑/删除逻辑
   - 数据刷新

6. **统计表格 (StatTable.vue)**
   - 多级表头完善
   - 单元格样式和格式化
   - 表格高度自适应

---

### P2 - 配置管理（第3周）

7. **列配置管理页**
   - 列树形编辑器
   - 列属性编辑
   - 配置保存/加载

8. **表单配置管理页**
   - 表单列表管理
   - 表单编辑器
   - 表单项管理

---

## 🔑 关键技术要点

### 1. 组件复用策略

**✅ 可直接复用的 HDty 组件**:
- `hd-date-picker` - 日期选择
- `hd-organ` - 机构选择
- `hd-region` - 地区选择
- `hd-dict-*` - 字典选择系列

**🔴 自研组件**:
- **统计表格** (`StatTable.vue`) - 个性化定制，基于 `el-table`
- **动态表格** (`DynamicTable`) - 用于明细列表
- **动态表单** (`DynamicForm`) - 用于明细表单（内部复用 HDty 字段组件）

---

### 2. 数据流转

```
统计列表页
    ↓ (点击单元格)
明细弹窗
    ↓ (加载表单配置)
动态表单 / 动态表格
    ↓ (提交数据)
API 保存
    ↓ (成功后)
刷新明细列表
    ↓
刷新统计数据
```

---

### 3. 配置驱动

**列配置示例**:
```javascript
{
  prop: 'field1',
  label: '字段1',
  width: 120,
  align: 'center',
  formId: 'form_001', // 点击后打开的表单ID
  clickable: true      // 是否可点击
}
```

**表单配置示例**:
```javascript
{
  prop: 'name',
  label: '姓名',
  type: 'input',
  required: true,
  span: 12,
  config: {
    placeholder: '请输入姓名',
    maxlength: 50
  },
  rules: [
    { required: true, message: '请输入姓名', trigger: 'blur' }
  ]
}
```

---

## ⚠️ 注意事项

1. **组件使用场景**:
   - `StatTable.vue`: **仅用于统计列表页**，个性化定制
   - `DynamicTable`: **仅用于明细列表**，配置驱动
   - `DynamicForm`: **仅用于明细表单**，配置驱动

2. **HDty 组件导入路径**:
   ```javascript
   // TODO: 根据项目实际路径调整
   import HdDatePicker from '@/components/HdForm/Items/hd-date-picker'
   import HdOrgan from '@/components/HdForm/Items/hd-organ'
   import HdRegion from '@/components/HdForm/Items/hd-region'
   ```

3. **Vuex 模块命名**:
   - `flexViewColumn` - 列配置状态
   - `flexViewForm` - 表单配置状态
   - `flexViewStat` - 统计数据状态

4. **路由命名**:
   - `FlexViewStat` - 统计列表页
   - `FlexViewColumnConfig` - 列配置页
   - `FlexViewFormConfig` - 表单配置列表页
   - `FlexViewFormEdit` - 表单编辑页

---

## 📝 后续开发建议

1. **第一步**: 先完善 `FieldRender.vue`，集成 HDty 组件
2. **第二步**: 完善 `DynamicForm.vue` 和 `DynamicTable.vue` 的逻辑
3. **第三步**: 开发统计列表页的业务逻辑
4. **第四步**: 开发配置管理页面

---

**文档版本**: v1.0  
**最后更新**: 2025-11-26  
**维护人**: 开发团队
