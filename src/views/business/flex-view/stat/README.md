# æ•°æ®æ™¾æ™’ç»Ÿè®¡é¡µé¢ - ä½¿ç”¨è¯´æ˜

## åŠŸèƒ½æ¦‚è¿°

æ•°æ®æ™¾æ™’ç»Ÿè®¡é¡µé¢æä¾›äº†å®Œæ•´çš„åŠ¨æ€ç»Ÿè®¡åˆ—è¡¨åŠäºŒçº§æ˜ç»†åŠŸèƒ½ï¼š

- âœ… **åŠ¨æ€å¤šå±‚çº§åˆ—è¡¨**: æ ¹æ®åˆ—é…ç½®åŠ¨æ€æ¸²æŸ“è¡¨æ ¼
- âœ… **å¯ç‚¹å‡»å•å…ƒæ ¼**: é…ç½® formId çš„åˆ—å¯ç‚¹å‡»æŸ¥çœ‹æ˜ç»†  
- âœ… **äºŒçº§æ˜ç»†åˆ—è¡¨**: å¼¹çª—å±•ç¤ºæ˜ç»†æ•°æ®åˆ—è¡¨
- âœ… **åŠ¨æ€è¡¨å•**: å®Œå…¨é…ç½®åŒ–çš„æŸ¥è¯¢ã€æ–°å¢ã€ç¼–è¾‘è¡¨å•
- âœ… **çµæ´»å¸ƒå±€**: é€šè¿‡JSONé…ç½®æ§åˆ¶è¡¨å•å¸ƒå±€
- âœ… **æ¡ä»¶æ ·å¼**: æ ¹æ®æ•°æ®å€¼åŠ¨æ€æ˜¾ç¤ºä¸åŒæ ·å¼
- âœ… **æ•°æ®æ ¼å¼åŒ–**: æ”¯æŒæ•°å­—ã€æ—¥æœŸã€å­—å…¸ç­‰æ ¼å¼åŒ–

## ç›®å½•ç»“æ„

```
stat/
â”œâ”€â”€ index.vue                   # ç»Ÿè®¡é¡µé¢ä¸»ç»„ä»¶
â”œâ”€â”€ api/
â”‚   â””â”€â”€ index.js               # APIæ¥å£å®šä¹‰
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ StatQuery.vue          # æŸ¥è¯¢ç»„ä»¶
â”‚   â”œâ”€â”€ StatTable.vue          # ç»Ÿè®¡è¡¨æ ¼ç»„ä»¶
â”‚   â”œâ”€â”€ DynamicColumn.vue      # åŠ¨æ€åˆ—ç»„ä»¶(é€’å½’)
â”‚   â””â”€â”€ DetailDialog.vue       # äºŒçº§æ˜ç»†å¼¹çª—ç»„ä»¶
â”œâ”€â”€ styles/                    # æ ·å¼æ–‡ä»¶
â”‚   â”œâ”€â”€ index.scss
â”‚   â”œâ”€â”€ stat-query.scss
â”‚   â”œâ”€â”€ stat-table.scss
â”‚   â”œâ”€â”€ theme-police.scss      # è­¦ç”¨è“ä¸»é¢˜
â”‚   â”œâ”€â”€ theme-green.scss       # ç§‘æŠ€ç»¿ä¸»é¢˜
â”‚   â””â”€â”€ theme-dark.scss        # æ·±é‚ƒé»‘ä¸»é¢˜
â””â”€â”€ README.md                  # æœ¬æ–‡ä»¶
```

## æ ¸å¿ƒç»„ä»¶è¯´æ˜

### 1. DetailDialog (äºŒçº§æ˜ç»†å¼¹çª—)

**åŠŸèƒ½**:
- æ ¹æ® formId åŠ è½½è¡¨å•é…ç½®
- åŠ¨æ€æ„å»ºæŸ¥è¯¢è¡¨å•ã€åˆ—è¡¨ã€æ–°å¢ç¼–è¾‘è¡¨å•
- å®ç°å®Œæ•´çš„å¢åˆ æ”¹æŸ¥åŠŸèƒ½

**Props**:
```javascript
{
  visible: Boolean,    // æ˜¯å¦æ˜¾ç¤º
  formId: String,      // è¡¨å•ID
  orgId: String,       // æœºæ„ID
  columnProp: String   // åˆ—å±æ€§å
}
```

**Events**:
```javascript
{
  'update:visible': Boolean,  // æ›´æ–°æ˜¾ç¤ºçŠ¶æ€
  'refresh': void             // åˆ·æ–°ç»Ÿè®¡æ•°æ®
}
```

### 2. DynamicColumn (åŠ¨æ€åˆ—ç»„ä»¶)

**åŠŸèƒ½**:
- é€’å½’æ¸²æŸ“å¤šå±‚çº§åˆ—
- æ”¯æŒç‚¹å‡»äº‹ä»¶
- æ”¯æŒæ¡ä»¶æ ·å¼
- æ”¯æŒæ•°æ®æ ¼å¼åŒ–

**Props**:
```javascript
{
  column: Object  // åˆ—é…ç½®å¯¹è±¡
}
```

### 3. StatTable (ç»Ÿè®¡è¡¨æ ¼)

**åŠŸèƒ½**:
- æ¸²æŸ“ç»Ÿè®¡è¡¨æ ¼
- å¤„ç†å•å…ƒæ ¼ç‚¹å‡»äº‹ä»¶
- æ”¯æŒåºå·åˆ—

## é…ç½®è¯´æ˜

### åˆ—é…ç½® (columnConfig JSON)

```json
{
  // ç‚¹å‡»é…ç½®
  "clickable": {
    "enabled": true,
    "formId": "FORM001",
    "openType": "dialog"
  },
  
  // æ ·å¼é…ç½®
  "style": {
    "color": "#409EFF",
    "cursor": "pointer"
  },
  
  // æ¡ä»¶æ ·å¼
  "conditional": {
    "rules": [
      {
        "condition": "value > 90",
        "style": { "color": "#67C23A" }
      }
    ]
  },
  
  // æ ¼å¼åŒ–
  "formatter": {
    "type": "number",
    "precision": 2
  }
}
```

### è¡¨å•é¡¹é…ç½® (itemConfig JSON)

```json
{
  // æ˜¾ç¤ºæ§åˆ¶
  "display": {
    "showInForm": true,
    "showInList": true,
    "showInQuery": false,
    "columnWidth": 120
  },
  
  // å¸ƒå±€é…ç½®
  "layout": {
    "span": 12,          // 12=åŠè¡Œ, 24=æ•´è¡Œ
    "labelWidth": "120px"
  },
  
  // éªŒè¯é…ç½®
  "validation": {
    "required": true,
    "message": "ä¸èƒ½ä¸ºç©º"
  },
  
  // ç»„ä»¶å±æ€§
  "componentProps": {
    "clearable": true,
    "filterable": true
  }
}
```

## ä½¿ç”¨ç¤ºä¾‹

### é…ç½®å¯ç‚¹å‡»åˆ—

1. åœ¨åˆ—é…ç½®ç®¡ç†ä¸­æ‰¾åˆ°è¦é…ç½®çš„åˆ—
2. ç¼–è¾‘ `columnConfig` å­—æ®µ:

```json
{
  "clickable": {
    "enabled": true,
    "formId": "CHECK_PERSON_FORM"
  },
  "style": {
    "color": "#409EFF",
    "cursor": "pointer",
    "textDecoration": "underline"
  }
}
```

3. ä¿å­˜é…ç½®ï¼Œåˆ·æ–°é¡µé¢å³å¯ç”Ÿæ•ˆ

### é…ç½®è¡¨å•é¡¹

1. åœ¨è¡¨å•é¡¹é…ç½®ä¸­ç¼–è¾‘ `itemConfig`
2. è®¾ç½®æ˜¾ç¤ºå’Œå¸ƒå±€:

```json
{
  "display": {
    "showInForm": true,
    "showInList": true,
    "showInQuery": true,
    "columnWidth": 120
  },
  "layout": {
    "span": 12
  }
}
```

### è¡¨å•å¸ƒå±€æ§åˆ¶

- **ä¸€è¡Œ2ä¸ªå­—æ®µ**: `"span": 12`
- **ç‹¬å ä¸€è¡Œ**: `"span": 24`

é€‚ç”¨åœºæ™¯:
- è¾“å…¥æ¡†ã€ä¸‹æ‹‰æ¡†ã€æ—¥æœŸ: span=12
- æ–‡æœ¬åŸŸã€JSONç¼–è¾‘å™¨: span=24

## API æ¥å£

### ç»Ÿè®¡æ•°æ®æ¥å£

```javascript
// è·å–åˆ—é…ç½®
GET /web/sjls/sysColumnConfig/showTree

// è·å–ç»Ÿè®¡æ•°æ®
POST /web/sjls/statData/page
```

### æ˜ç»†æ•°æ®æ¥å£

```javascript
// è·å–è¡¨å•é…ç½®
POST /web/sjls/sysFormConfig/detail?id=xxx

// è·å–è¡¨å•é¡¹åˆ—è¡¨
POST /web/sjls/sysFormItemConfig/page

// æ˜ç»†æ•°æ® CRUD
POST /web/sjls/detailData/page    // æŸ¥è¯¢
POST /web/sjls/detailData/add     // æ–°å¢
POST /web/sjls/detailData/update  // æ›´æ–°
POST /web/sjls/detailData/delete  // åˆ é™¤
```

## ä¸»é¢˜åˆ‡æ¢

æ”¯æŒ3ç§ä¸»é¢˜:
- ğŸ”µ è­¦ç”¨è“ (police) - é»˜è®¤
- ğŸŸ¢ ç§‘æŠ€ç»¿ (green)
- âš« æ·±é‚ƒé»‘ (dark)

ç‚¹å‡»å³ä¸Šè§’ä¸»é¢˜åˆ‡æ¢æŒ‰é’®å³å¯åˆ‡æ¢ã€‚

## æ³¨æ„äº‹é¡¹

1. **JSONæ ¼å¼**: é…ç½®å¿…é¡»æ˜¯åˆæ³•çš„JSON
2. **formIdå…³è”**: ç¡®ä¿å…³è”çš„è¡¨å•å·²é…ç½®
3. **å­—å…¸ç¼–ç **: dictCodeè¦ä¸ç³»ç»Ÿå­—å…¸ä¸€è‡´
4. **å­—æ®µæ˜ å°„**: tableKeyè¦ä¸æ•°æ®åº“å­—æ®µå¯¹åº”
5. **å‘åå…¼å®¹**: æœªé…ç½®çš„å­—æ®µä½¿ç”¨é»˜è®¤å€¼

## å¸¸è§é—®é¢˜

### Q: åˆ—ç‚¹å‡»æ²¡ååº”?
**A**: æ£€æŸ¥ columnConfig ä¸­çš„ `clickable.enabled` å’Œ `clickable.formId`

### Q: è¡¨å•å­—æ®µä¸æ˜¾ç¤º?
**A**: æ£€æŸ¥ itemConfig ä¸­çš„ `display.showInForm`

### Q: è¡¨å•å¸ƒå±€ä¸å¯¹?
**A**: æ£€æŸ¥ `layout.span` é…ç½®ï¼Œ12=åŠè¡Œï¼Œ24=æ•´è¡Œ

### Q: å­—å…¸ä¸æ˜¾ç¤º?
**A**: æ£€æŸ¥ `componentProps.dictCode` ä¸ç³»ç»Ÿå­—å…¸æ˜¯å¦ä¸€è‡´

## å¼€å‘è®¡åˆ’

- [x] åŠ¨æ€å¤šå±‚çº§åˆ—è¡¨
- [x] å¯ç‚¹å‡»å•å…ƒæ ¼
- [x] äºŒçº§æ˜ç»†å¼¹çª—
- [x] åŠ¨æ€è¡¨å•(æŸ¥è¯¢/æ–°å¢/ç¼–è¾‘)
- [x] çµæ´»å¸ƒå±€æ§åˆ¶
- [x] æ¡ä»¶æ ·å¼
- [x] æ•°æ®æ ¼å¼åŒ–
- [ ] å­—æ®µè”åŠ¨
- [ ] æ¡ä»¶æ˜¾ç¤º/éšè—
- [ ] æ‰¹é‡å¯¼å…¥/å¯¼å‡º

## å‚è€ƒæ–‡æ¡£

- [åŠ¨æ€è¡¨å•JSONé…ç½®è§„èŒƒ](../../../../project-docs/09-åŠ¨æ€è¡¨å•JSONé…ç½®è§„èŒƒ.md)
- [åŠ¨æ€ç»Ÿè®¡åˆ—è¡¨ä¸äºŒçº§æ˜ç»†å®ç°è¯´æ˜](../../../../project-docs/10-åŠ¨æ€ç»Ÿè®¡åˆ—è¡¨ä¸äºŒçº§æ˜ç»†å®ç°è¯´æ˜.md)
- [æ•°æ®åº“è®¾è®¡æ–‡æ¡£](../../../../dev-document/01-æ•°æ®åº“è®¾è®¡æ–‡æ¡£.md)

---

**ç»´æŠ¤äººå‘˜**: å¼€å‘å›¢é˜Ÿ  
**æœ€åæ›´æ–°**: 2025-12-02
