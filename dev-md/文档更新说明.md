# 文档更新说明 (2025-11-25 全面优化版)

## 📝 更新概述

本次更新根据业务设计修改要求,对整个系统进行了全面优化,包括数据库设计、业务逻辑、扩展性等多个方面,并新增了《系统设计讲解说明文档》。

---

## 🔄 主要变更

### 1. 人员信息存储调整

#### 原设计 ❌
```sql
-- 使用用户ID
CREATE_USER_ID    VARCHAR2(32)
UPDATE_USER_ID    VARCHAR2(32)
ZXR_USERID        VARCHAR2(32)
```

#### 新设计 ✅
```sql
-- 使用身份证号
CREATE_USER_GMSFHM  VARCHAR2(18)  -- 采集人身份证号
UPDATE_USER_GMSFHM  VARCHAR2(18)  -- 操作人身份证号
ZXR_USER_GMSFHM     VARCHAR2(18)  -- 注销人身份证号
```

**优势**:
- ✅ 身份证号具有唯一性,不会变更
- ✅ 便于跨系统数据关联和审计
- ✅ 符合政务系统的实际业务需求

**影响范围**:
- `SYS_COLUMN_CONFIG` - 列配置表
- `SYS_FORM_CONFIG` - 表单配置表
- `SYS_FORM_ITEM_CONFIG` - 表单项配置表
- `BIZ_DATA_COMMON` - 业务数据表
- `STAT_BASE_DATA` - 统计底数表

---

### 2. JSON字段存储类型调整

#### 原设计 ❌
```sql
COLUMN_CONFIG     VARCHAR2(4000)  -- 有长度限制
ITEM_CONFIG       VARCHAR2(4000)  -- 有长度限制
```

#### 新设计 ✅
```sql
COLUMN_CONFIG     CLOB  -- 无长度限制
FORM_CONFIG       CLOB  -- 新增表单配置JSON
ITEM_CONFIG       CLOB  -- 无长度限制
```

**优势**:
- ✅ CLOB类型支持更大的配置数据(最大4GB)
- ✅ 支持复杂的配置规则(联动、条件显示等)
- ✅ 避免配置截断问题

---

### 3. 列配置表启用状态增强

#### 新增字段
```sql
STATUS              VARCHAR2(1) DEFAULT '1' NOT NULL,   -- 启用状态: 1-启用 0-停用
STATUS_REMARK       VARCHAR2(500),                      -- 启用/停用备注
ENABLE_USER_GMSFHM  VARCHAR2(18),                       -- 启用操作人身份证号
ENABLE_USERNAME     VARCHAR2(50),                       -- 启用操作人姓名
ENABLE_TIME         VARCHAR2(14),                       -- 启用操作时间
DISABLE_USER_GMSFHM VARCHAR2(18),                       -- 停用操作人身份证号
DISABLE_USERNAME    VARCHAR2(50),                       -- 停用操作人姓名
DISABLE_TIME        VARCHAR2(14),                       -- 停用操作时间
```

**优势**:
- ✅ 支持列的启用/停用操作,不需删除
- ✅ 记录操作人和操作时间,便于审计
- ✅ 支持备注说明,方便业务理解

**使用场景**:
```sql
-- 停用某一列(不删除,可恢复)
UPDATE SYS_COLUMN_CONFIG 
SET STATUS = '0',
    STATUS_REMARK = '该指标暂不统计',
    DISABLE_USER_GMSFHM = '110101199001011234',
    DISABLE_USERNAME = '张三',
    DISABLE_TIME = '20251125120000'
WHERE ID = 'COL001';

-- 前端查询只显示启用的列
SELECT * FROM SYS_COLUMN_CONFIG 
WHERE STATUS = '1' AND ZXBS = '0';
```

---

### 4. 表单配置增强FORM_CONFIG字段

#### 新增字段
```sql
FORM_CONFIG  CLOB  -- 表单配置JSON(表单级别的配置)
```

**用途**:
存储表单级别的配置,如:
- 表单布局 (vertical/horizontal)
- 标签宽度 (labelWidth)
- 表单校验规则
- 提交前钩子函数
- 自定义按钮配置

**示例**:
```json
{
  "layout": "vertical",
  "labelWidth": "120px",
  "labelPosition": "right",
  "size": "medium",
  "validateOnRuleChange": true,
  "hideRequiredAsterisk": false,
  "showMessage": true,
  "customButtons": [
    {
      "label": "审核通过",
      "type": "success",
      "action": "approve"
    }
  ]
}
```

---

### 5. 表单项配置调整(USE_TYPE字段移除)

#### 原设计 ❌
```sql
USE_TYPE  VARCHAR2(2)  -- 01-app表单 02-app列表 03-pc列表 04-pc表单
```

#### 新设计 ✅
移除USE_TYPE字段,简化设计。

**理由**:
1. 实际场景中,同一表单项在不同场景的配置可以通过ITEM_CONFIG的JSON来区分
2. 如需多场景,可以通过创建多个表单来实现
3. 简化表结构,降低复杂度

---

### 6. 底数表重新设计(核心变更)

#### 原设计 ❌
```sql
-- 按机构、日期、业务类别维度
STAT_DAILY_BASE (
    ORG_ID,
    STAT_DATE,
    CATEGORY,
    POPULATION_TOTAL,        -- 人口总数
    POPULATION_CHECK_RATE,   -- 核查率
    UNIT_TOTAL,              -- 单位总数
    UNIT_CHECK_RATE,         -- 单位核查率
    ...                      -- 大量固定字段
)
```

**问题**:
1. 新增业务类别需要添加列
2. 不同业务的字段差异大,大量NULL值
3. 复杂指标(比率、平均值)难以扩展

#### 新设计 ✅
```sql
-- 按字段维度存储
STAT_BASE_DATA (
    FORM_ID,          -- 表单ID
    FORM_ITEM_ID,     -- 表单项ID(字段ID)
    STAT_DATE,        -- 统计日期
    ORG_ID,           -- 机构ID
    VALUE_TYPE,       -- 值类型: count/avg/rate/sum/composite
    VALUE_1,          -- 主值
    VALUE_2,          -- 辅助值1
    VALUE_3,          -- 辅助值2
    STAT_PERIOD       -- 统计周期: day/week/month/quarter/year
)
```

**优势**:
- ✅ 按字段存储,更细粒度
- ✅ 新增业务无需加列
- ✅ VALUE_TYPE支持多种指标类型
- ✅ 三个值字段可组合计算复杂指标
- ✅ 支持多时间维度统计(day/week/month等)

**VALUE_TYPE说明**:

| 类型      | VALUE_1  | VALUE_2 | VALUE_3 | 示例             |
| --------- | -------- | ------- | ------- | ---------------- |
| count     | 计数结果 | -       | -       | 总数:500         |
| avg       | 平均值   | -       | -       | 平均耗时:2.5小时 |
| rate      | 比率(%)  | 分子    | 分母    | 95.4% (477/500)  |
| sum       | 求和     | -       | -       | 金额:100000      |
| composite | 值1      | 值2     | 值3     | 综合指标         |

**示例对比**:

```sql
-- 旧设计: 一个机构一行,所有指标作为列
INSERT INTO STAT_DAILY_BASE VALUES (
    'STAT001', 'ORG001', '20251125', 'POPULATION',
    500,    -- POPULATION_TOTAL
    95.5,   -- POPULATION_CHECK_RATE
    200,    -- POPULATION_FLOATING
    ...
);

-- 新设计: 每个指标一行
-- 总数
INSERT INTO STAT_BASE_DATA VALUES (
    'STAT001', 'FORM_POP', 'ITEM_TOTAL', '20251125', 'ORG001',
    'count', 500, NULL, NULL, 'day'
);

-- 核查率(含分子分母)
INSERT INTO STAT_BASE_DATA VALUES (
    'STAT002', 'FORM_POP', 'ITEM_RATE', '20251125', 'ORG001',
    'rate', 95.4, 477, 500, 'day'  -- 95.4% = 477/500*100
);
```

---

## 🆕 新增文档

### 《系统设计讲解说明文档》

新增了一份详细的系统设计讲解文档,内容包括:

1. **业务背景与目标**
   - 什么是数据晓晒
   - 系统核心目标

2. **核心设计思想**
   - 配置驱动 vs 硬编码
   - JSON存储 + 字段映射机制
   - 三层配置架构

3. **数据库设计详解**
   - 表设计逻辑
   - 底数表重新设计原理
   - 关键表详解

4. **业务流程详解**
   - 完整业务链路
   - 数据录入流程
   - 统计计算流程

5. **核心技术实现**
   - 动态SQL构建
   - 字段映射工具

6. **系统扩展维度**
   - 新增业务类别
   - 新增表单字段
   - 多维度统计扩展

7. **完整业务示例**
   - 社区矛盾纠纷统计模块完整配置

8. **学习路径建议**
   - 新人上手顺序
   - 常见问题FAQ

---

## 📄 文档更新清单

### 核心文档

- [x] **需求规格说明书** - 保持不变
- [x] **系统架构设计文档** - 待更新(底数表设计部分)
- [x] **数据库设计文档** - 已更新
  - [x] 人员字段改为身份证号
  - [x] JSON字段改为CLOB
  - [x] 列配置表增加启用状态
  - [x] 表单配置表增加FORM_CONFIG
  - [x] 表单项配置表移除USE_TYPE
  - [x] 底数表重新设计
- [ ] **前端开发文档** - 待更新
- [ ] **后端开发文档** - 待更新
- [x] **文档更新说明** - 已更新(当前文档)

### 新增文档

- [x] **系统设计讲解说明文档** - 已创建

---

## 🔧 迁移指南

如果需要从旧设计迁移到新设计:

### 步骤1: 数据库表结构调整

```sql
-- 1. 修改列配置表
ALTER TABLE SYS_COLUMN_CONFIG ADD (
    STATUS VARCHAR2(1) DEFAULT '1' NOT NULL,
    STATUS_REMARK VARCHAR2(500),
    ENABLE_USER_GMSFHM VARCHAR2(18),
    ENABLE_USERNAME VARCHAR2(50),
    ENABLE_TIME VARCHAR2(14),
    DISABLE_USER_GMSFHM VARCHAR2(18),
    DISABLE_USERNAME VARCHAR2(50),
    DISABLE_TIME VARCHAR2(14)
);

ALTER TABLE SYS_COLUMN_CONFIG MODIFY COLUMN_CONFIG CLOB;

-- 2. 修改表单配置表
ALTER TABLE SYS_FORM_CONFIG ADD FORM_CONFIG CLOB;

-- 3. 修改表单项配置表
ALTER TABLE SYS_FORM_ITEM_CONFIG DROP COLUMN USE_TYPE;
ALTER TABLE SYS_FORM_ITEM_CONFIG MODIFY ITEM_CONFIG CLOB;

-- 4. 重建底数表
DROP TABLE STAT_DAILY_BASE;
CREATE TABLE STAT_BASE_DATA (...);

-- 5. 人员字段调整(所有表)
ALTER TABLE SYS_COLUMN_CONFIG 
    ADD CREATE_USER_GMSFHM VARCHAR2(18),
    ADD UPDATE_USER_GMSFHM VARCHAR2(18),
    ADD ZXR_USER_GMSFHM VARCHAR2(18);
    
-- 数据迁移(如果有旧数据)
UPDATE SYS_COLUMN_CONFIG SET 
    CREATE_USER_GMSFHM = (
        SELECT GMSFHM FROM SYS_USER WHERE USER_ID = CREATE_USER_ID
    );
    
ALTER TABLE SYS_COLUMN_CONFIG 
    DROP COLUMN CREATE_USER_ID,
    DROP COLUMN UPDATE_USER_ID,
    DROP COLUMN ZXR_USERID;
```

### 步骤2: 应用代码调整

**后端调整**:
```java
// 修改实体类
public class SysColumnConfig {
    // 旧字段
    // private String createUserId;
    
    // 新字段
    private String createUserGmsfhm;  // 身份证号
    
    // 新增字段
    private String status;
    private String statusRemark;
    private String enableUserGmsfhm;
    // ...
}

// 查询时增加STATUS过滤
List<SysColumnConfig> list = columnMapper.selectList(
    new QueryWrapper<SysColumnConfig>()
        .eq("STATUS", "1")  // 只查启用的
        .eq("ZXBS", "0")    // 未注销的
        .orderByAsc("SORT_NUM")
);
```

**前端调整**:
```javascript
// 删除USE_TYPE相关逻辑
// const { data } = await getFormItems(formId, '04')

// 改为
const { data } = await getFormItems(formId)
```

### 步骤3: 数据迁移脚本

```sql
-- 底数表数据迁移(示例)
INSERT INTO STAT_BASE_DATA (
    ID, FORM_ID, FORM_ITEM_ID, STAT_DATE, ORG_ID,
    VALUE_TYPE, VALUE_1, VALUE_2, VALUE_3, STAT_PERIOD
)
SELECT 
    SYS_GUID(),
    'FORM_POPULATION',  -- 表单ID(需映射)
    'ITEM_TOTAL',       -- 字段ID(需映射)
    TO_CHAR(STAT_DATE, 'YYYYMMDD'),
    ORG_ID,
    'count',
    POPULATION_TOTAL,
    NULL,
    NULL,
    'day'
FROM STAT_DAILY_BASE
WHERE CATEGORY = 'POPULATION';
```

---

## ✅ 验收检查清单

### 数据库层

- [ ] 所有表的人员字段已改为身份证号(GMSFHM)
- [ ] 所有JSON字段已改为CLOB类型
- [ ] SYS_COLUMN_CONFIG表增加了STATUS相关字段
- [ ] SYS_FORM_CONFIG表增加了FORM_CONFIG字段
- [ ] SYS_FORM_ITEM_CONFIG表删除了USE_TYPE字段
- [ ] STAT_BASE_DATA表已创建,索引完善
- [ ] 示例数据插入成功

### 应用层

- [ ] 后端实体类更新
- [ ] Mapper查询增加STATUS过滤
- [ ] 前端 API调用修改
- [ ] 启用/停用功能测试成功
- [ ] 底数表统计逻辑重写成功

### 功能测试

- [ ] 列配置启用/停用功能正常
- [ ] 表单配置FORM_CONFIG解析正确
- [ ] 表单项ITEM_CONFIG(CLOB)解析正常
- [ ] 底数表按字段维度统计正确
- [ ] 多种 VALUE_TYPE 统计正常(count/avg/rate/sum)
- [ ] 多时间维度统计正常(day/week/month)

---

## 📚 相关文档

- [系统设计讲解说明文档.md](./系统设计讲解说明文档.md) - **新增**
- [数据库设计文档.md](./数据库设计文档.md) - **已更新**
- [需求规格说明书.md](./需求规格说明书.md)
- [系统架构设计文档.md](./系统架构设计文档.md) - **待更新**
- [前端开发文档.md](./前端开发文档.md) - **待更新**
- [后端开发文档.md](./后端开发文档.md) - **待更新**

---

**文档版本**: 2.0  
**更新日期**: 2025-11-25  
**更新人**: AI Assistant

## 📋 更新概述

根据现有系统的表结构 (`F_ITEM_` 系列字段),对数据库设计和前端开发文档进行了优化调整,使其更符合实际业务场景。

---

## 🔄 主要变更

### 1. 数据库表设计调整

#### 原设计 ❌
```
SYS_FORM_FIELD_CONFIG (表单字段配置表)
- 字段分散存储在多个列中
- FIELD_NAME, FIELD_LABEL, FIELD_TYPE...
- IS_REQUIRED, MAX_LENGTH, MIN_LENGTH, PATTERN...
- SHOW_IN_FORM, SHOW_IN_LIST, SHOW_IN_QUERY...
```

#### 新设计 ✅
```
SYS_FORM_ITEM_CONFIG (表单组件配置表)
- 核心字段:
  * ITEM_TYPE (组件类型)
  * ITEM_LABEL (组件标签)
  * ITEM_PROP (绑定属性名)
  * ITEM_CONFIG (JSON配置 - 包含所有渲染规则)
  
- 固定字段映射:
  * IS_FIXED (是否固定项)
  * TABLE_KEY (对应数据库列名)
  * KEY_TYPE (列类型:dic/region等)
  * DIC_TYPE (字典类型)
  
- 使用场景:
  * USE_TYPE (01-app表单 02-app列表 03-pc列表 04-pc表单)
```

---

## 🎯 核心改进点

### 1.1 ITEM_CONFIG JSON配置结构

**优势**: 将所有渲染规则、验证规则、显示控制等配置统一到JSON中,极大提升灵活性

```json
{
  // 基础配置
  "defaultValue": "",
  "placeholder": "请选择抽查时间",
  
  // 验证规则
  "rules": {
    "required": true,
    "message": "抽查时间不能为空",
    "trigger": "blur",
    "maxLength": 100,
    "pattern": ""
  },
  
  // 显示控制
  "display": {
    "showInForm": true,
    "showInList": true,
    "showInQuery": true,
    "columnWidth": 120,
    "disabled": false,
    "readonly": false
  },
  
  // 数据映射
  "dataMapping": {
    "isIndexField": true,
    "dbColumn": "CHECK_TIME",
    "dataType": "DATE"
  },
  
  // 选项配置
  "options": {
    "dictType": "check_result",
    "keyType": "dic",
    "data": [
      {"label": "合格", "value": "1"},
      {"label": "不合格", "value": "0"}
    ]
  },
  
  // 组件特定配置
  "componentProps": {
    "type": "date",
    "format": "yyyy-MM-dd",
    "clearable": true,
    "size": "medium"
  },
  
  // 联动配置
  "linkage": {
    "trigger": "checkResult",
    "rules": [...]
  },
  
  // 布局配置
  "layout": {
    "span": 12,
    "labelWidth": "120px"
  }
}
```

### 1.2 字段映射机制保留

参考原系统设计,保留了固定字段映射功能:

| 字段      | 说明            | 用途                         |
| --------- | --------------- | ---------------------------- |
| IS_FIXED  | 是否固定项(0/1) | 标识是否映射到数据库列       |
| TABLE_KEY | 数据库列名      | 固定属性对应的列名           |
| KEY_TYPE  | 列类型          | dic(字典)/region(行政区划)等 |
| DIC_TYPE  | 字典类型        | 需要翻译时的字典编码         |

**映射流程**:
```
前端字段 → ITEM_PROP → (IS_FIXED=1) → TABLE_KEY(数据库列)
          ↓
        (IS_FIXED=0) → 仅存JSON
```

### 1.3 使用场景区分

新增 `USE_TYPE` 字段,支持一个表单在不同场景下使用不同配置:

- **01** - app表单 (移动端表单页)
- **02** - app列表 (移动端列表页)
- **03** - pc列表 (PC端列表页)
- **04** - pc表单 (PC端表单页)

**优势**: 同一业务表单可以在PC和移动端有不同的展示方式

### 1.4 注销机制

参考原系统,添加了完整的注销标识字段:

```sql
ZXBS              VARCHAR2(1) DEFAULT '0' NOT NULL,   -- 注销状态: 0-未注销 1-已注销
ZXR_USERID        VARCHAR2(32),                       -- 注销人用户ID
ZXR_USERNAME      VARCHAR2(30),                       -- 注销人姓名
ZXDW              VARCHAR2(12),                       -- 注销机构
ZXSJ              VARCHAR2(14),                       -- 注销时间
ZXYY              VARCHAR2(500),                      -- 注销原因
```

**优势**: 支持逻辑删除,可追溯删除历史

---

## 📊 示例对比

### 抽查时间字段配置

#### 原设计(字段分散)
```sql
INSERT INTO SYS_FORM_FIELD_CONFIG (
    FIELD_NAME, FIELD_LABEL, FIELD_TYPE,
    IS_REQUIRED, DB_COLUMN, DATA_TYPE, IS_INDEX_FIELD,
    SHOW_IN_LIST, SHOW_IN_QUERY
) VALUES (
    'checkTime', '抽查时间', 'date',
    'true', 'CHECK_TIME', 'DATE', 'true',
    'true', 'true'
);
```

#### 新设计(JSON集中)
```sql
INSERT INTO SYS_FORM_ITEM_CONFIG (
    ITEM_TYPE, ITEM_LABEL, ITEM_PROP, ITEM_CONFIG,
    USE_TYPE, IS_FIXED, TABLE_KEY, KEY_TYPE
) VALUES (
    'date', '抽查时间', 'checkTime',
    '{
      "rules":{"required":true,"message":"抽查时间不能为空"},
      "display":{"showInForm":true,"showInList":true,"showInQuery":true,"columnWidth":120},
      "dataMapping":{"isIndexField":true,"dbColumn":"CHECK_TIME","dataType":"DATE"},
      "componentProps":{"type":"date","format":"yyyy-MM-dd","clearable":true},
      "layout":{"span":12,"labelWidth":"120px"}
    }',
    '04', '1', 'CHECK_TIME', 'date'
);
```

**对比优势**:
1. ✅ 所有渲染规则集中在JSON,便于扩展
2. ✅ 无需新增列即可添加新配置项
3. ✅ 前端直接解析JSON即可渲染
4. ✅ 支持复杂配置(如联动、条件显示等)

---

## 🔧 前端代码调整

### API接口更新

```javascript
// 旧接口
getFormFields(formId)

// 新接口(支持按场景过滤)
getFormItems(formId, useType)  // useType: '04' 表示PC表单
```

### 组件渲染更新

```vue
<!-- 旧方式:从多个字段读取配置 -->
<el-input
  :placeholder="field.placeholder"
  :maxlength="field.maxLength"
  :disabled="field.disabled"
/>

<!-- 新方式:从JSON统一读取 -->
<el-input
  :placeholder="itemConfig.componentProps?.placeholder"
  :maxlength="itemConfig.componentProps?.maxlength"
  :disabled="itemConfig.display?.disabled"
/>
```

### 验证规则解析

```javascript
// 旧方式:从字段属性读取
if (field.isRequired === 'true') {
  rules.push({ required: true, message: `${field.fieldLabel}不能为空` })
}

// 新方式:从JSON读取
const config = JSON.parse(item.itemConfig)
if (config.rules?.required) {
  rules.push({
    required: true,
    message: config.rules.message || `${item.itemLabel}不能为空`,
    trigger: config.rules.trigger || 'blur'
  })
}
```

---

## 📈 优势总结

### 1. 灵活性
- ✅ 新增配置项无需修改表结构
- ✅ 支持复杂配置(联动、条件显示、远程数据源等)
- ✅ 同一字段在不同场景可有不同配置

### 2. 可扩展性
- ✅ JSON格式易于扩展
- ✅ 支持app和pc端差异化配置
- ✅ 可快速接入新组件类型

### 3. 性能
- ✅ 减少表列数,降低查询开销
- ✅ 按USE_TYPE过滤,仅查询需要的配置
- ✅ 前端缓存JSON配置

### 4. 维护性
- ✅ 配置集中,易于理解和维护
- ✅ JSON结构清晰,便于版本管理
- ✅ 注销机制完善,可追溯历史

---

## 🎯 最佳实践

### 1. 固定字段设置原则
```javascript
// 需要查询、统计的字段 → IS_FIXED=1
{
  "itemProp": "checkTime",
  "isFIXED": "1",
  "tableKey": "CHECK_TIME",
  "dataMapping": {
    "isIndexField": true,
    "dbColumn": "CHECK_TIME"
  }
}

// 仅展示的字段 → IS_FIXED=0
{
  "itemProp": "remark",
  "isFixed": "0",
  "dataMapping": {
    "isIndexField": false
  }
}
```

### 2. 字典翻译配置
```javascript
{
  "itemType": "select",
  "itemProp": "checkResult",
  "isFixed": "1",
  "tableKey": "CHECK_RESULT",
  "keyType": "dic",  // 标识为字典类型
  "dicType": "check_result",  // 字典编码
  "itemConfig": {
    "options": {
      "dictType": "check_result",
      "keyType": "dic"
    }
  }
}
```

### 3. 多场景配置
```sql
-- PC端表单:完整字段
INSERT INTO SYS_FORM_ITEM_CONFIG (..., USE_TYPE, ITEM_CONFIG) 
VALUES (..., '04', '{"display":{"showInForm":true}}');

-- 移动端表单:精简字段
INSERT INTO SYS_FORM_ITEM_CONFIG (..., USE_TYPE, ITEM_CONFIG)
VALUES (..., '01', '{"display":{"showInForm":true},"layout":{"span":24}}');

-- PC端列表:仅显示核心列
INSERT INTO SYS_FORM_ITEM_CONFIG (..., USE_TYPE, ITEM_CONFIG)
VALUES (..., '03', '{"display":{"showInList":true,"columnWidth":120}}');
```

---

## 📝 迁移建议

如果现有系统需要迁移到新设计:

### 步骤1: 创建新表
```sql
CREATE TABLE SYS_FORM_ITEM_CONFIG (...);
```

### 步骤2: 数据迁移脚本
```sql
INSERT INTO SYS_FORM_ITEM_CONFIG (
    ID, FORM_ID, ITEM_TYPE, ITEM_LABEL, ITEM_PROP, ITEM_CONFIG,
    IS_FIXED, TABLE_KEY, KEY_TYPE, USE_TYPE, ...
)
SELECT 
    ID,
    FORM_ID,
    FIELD_TYPE AS ITEM_TYPE,
    FIELD_LABEL AS ITEM_LABEL,
    FIELD_NAME AS ITEM_PROP,
    -- 构建JSON配置
    '{' ||
        '"rules":{"required":' || (CASE WHEN IS_REQUIRED='true' THEN 'true' ELSE 'false' END) || ',' ||
                  '"maxLength":' || NVL(TO_CHAR(MAX_LENGTH), 'null') || '},' ||
        '"display":{"showInForm":' || (CASE WHEN SHOW_IN_FORM='true' THEN 'true' ELSE 'false' END) || ',' ||
                    '"showInList":' || (CASE WHEN SHOW_IN_LIST='true' THEN 'true' ELSE 'false' END) || '},' ||
        '"dataMapping":{"isIndexField":' || (CASE WHEN IS_INDEX_FIELD='true' THEN 'true' ELSE 'false' END) || ',' ||
                        '"dbColumn":"' || NVL(DB_COLUMN, '') || '"}' ||
    '}' AS ITEM_CONFIG,
    CASE WHEN IS_INDEX_FIELD='true' THEN '1' ELSE '0' END AS IS_FIXED,
    DB_COLUMN AS TABLE_KEY,
    NULL AS KEY_TYPE,
    '04' AS USE_TYPE,  -- 默认为PC表单
    ...
FROM SYS_FORM_FIELD_CONFIG;
```

### 步骤3: 前端代码适配
```javascript
// 1. 更新API调用
const { data } = await getFormItems(formId, '04')

// 2. 更新组件props
<form-item :item="item" />  // 传递完整的item对象

// 3. 解析JSON配置
const config = JSON.parse(item.itemConfig || '{}')
```

---

## ✅ 验收检查清单

- [ ] 数据库表创建成功
- [ ] 示例数据插入正常
- [ ] 前端能正确解析ITEM_CONFIG JSON
- [ ] 固定字段映射正确(IS_FIXED=1的字段)
- [ ] 字典翻译正常(KEY_TYPE=dic)
- [ ] 多场景配置生效(USE_TYPE区分)
- [ ] 注销功能正常(ZXBS标识)
- [ ] 验证规则正确应用
- [ ] 组件渲染符合预期

---

**文档版本**: 1.0  
**更新日期**: 2025-11-25  
**更新人**: AI Assistant
