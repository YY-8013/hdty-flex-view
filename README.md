# 数据晾晒统计系统 - 项目文档集

## 📋 项目概述

本项目是一个**高度可配置的数据统计与录入平台**,用于多机构、多业务类别的数据晾晒展示。系统采用配置驱动的设计思想,支持动态配置统计列、多级表头展示、明细数据录入等功能,满足业务快速扩展的需求。

### 核心特性

✅ **配置驱动** - 通过配置实现功能,无需修改代码  
✅ **动态表单** - 表单字段完全可配置,支持多种组件类型  
✅ **多级表头** - 支持树形结构的多级表头展示  
✅ **字段映射** - JSON存储+字段映射,兼顾灵活性和性能  
✅ **灵活统计** - 支持多种指标类型(计数、平均、比率等)  
✅ **多维分析** - 支持按日/周/月/季/年等多时间维度统计

### 技术栈

- **前端**: Vue 2.6+ / Webpack / Element-UI
- **后端**: Java Spring Boot / MyBatis
- **数据库**: Oracle 11g+ (PL/SQL)

---

## 📚 文档目录

### 核心设计文档

| 文档                                         | 说明                             | 状态     |
| -------------------------------------------- | -------------------------------- | -------- |
| [需求规格说明书.md](./需求规格说明书.md)     | 业务需求、功能需求、非功能需求   | ✅ 完成   |
| [系统架构设计文档.md](./系统架构设计文档.md) | 整体架构、核心技术方案、性能优化 | ⏳ 待更新 |
| [数据库设计文档.md](./数据库设计文档.md)     | 表结构设计、存储过程、视图设计   | ✅ 已优化 |

### 开发文档

| 文档                                 | 说明                             | 状态     |
| ------------------------------------ | -------------------------------- | -------- |
| [前端开发文档.md](./前端开发文档.md) | Vue2组件开发、动态表单、多级表头 | ⏳ 待更新 |
| [后端开发文档.md](./后端开发文档.md) | API设计、动态SQL、字段映射工具   | ⏳ 待更新 |

### 辅助文档

| 文档                                                 | 说明                   | 状态     |
| ---------------------------------------------------- | ---------------------- | -------- |
| [系统设计讲解说明文档.md](./系统设计讲解说明文档.md) | 从零开始的完整设计讲解 | ✅ 新增   |
| [文档更新说明.md](./文档更新说明.md)                 | 本次优化的详细变更记录 | ✅ 已更新 |

---

## 🎯 快速开始

### 新人学习路径

**第1步**: 阅读《系统设计讲解说明文档》,理解核心设计思想

**第2步**: 阅读《需求规格说明书》,了解业务背景

**第3步**: 阅读《数据库设计文档》,掌握表结构设计

**第4步**: 阅读《前端开发文档》和《后端开发文档》,进行开发

**第5步**: 参考完整示例,实践配置一个完整的业务模块

### 文档阅读顺序

```
入门阶段:
1. 系统设计讲解说明文档.md (必读,理解核心设计)
2. 需求规格说明书.md (必读,了解业务)
3. 文档更新说明.md (推荐,了解最新变更)

开发阶段:
4. 数据库设计文档.md (必读,表结构设计)
5. 前端开发文档.md (前端开发人员必读)
6. 后端开发文档.md (后端开发人员必读)
7. 系统架构设计文档.md (架构师必读)
```

---

## 🔄 本次优化要点

### 1. 人员信息存储优化

**变更**: 所有表关于人的信息,不存ID,存人的身份证号

**影响字段**:
- `CREATE_USER_GMSFHM` (采集人身份证号)
- `UPDATE_USER_GMSFHM` (操作人身份证号)
- `ZXR_USER_GMSFHM` (注销人身份证号)

**优势**: 身份证号具有唯一性且不变,便于跨系统关联和审计

### 2. JSON字段存储优化

**变更**: 所有预留的自定义配置JSON字段,都用CLOB存储

**影响字段**:
- `COLUMN_CONFIG` - 列前端配置JSON
- `FORM_CONFIG` - 表单配置JSON (新增)
- `ITEM_CONFIG` - 表单项配置JSON

**优势**: CLOB类型无长度限制,支持更复杂的配置规则

### 3. 列配置表启用状态增强

**新增字段**:
- `STATUS` - 启用状态 (1-启用 0-停用)
- `STATUS_REMARK` - 启用/停用备注
- `ENABLE_USER_GMSFHM` - 启用操作人身份证号
- `ENABLE_USERNAME` - 启用操作人姓名
- `ENABLE_TIME` - 启用操作时间
- `DISABLE_USER_GMSFHM` - 停用操作人身份证号
- `DISABLE_USERNAME` - 停用操作人姓名
- `DISABLE_TIME` - 停用操作时间

**优势**: 支持列的启用/停用管理,记录操作人和操作时间

### 4. 表单配置表增强

**新增字段**:
- `FORM_CONFIG` - 表单级别的配置JSON

**用途**: 存储表单级别配置(布局、标签宽度、校验规则等)

### 5. 表单组件配置表优化

**调整**: 移除 `USE_TYPE` 字段,简化设计

**原因**: 同一表单项在不同场景的配置可通过JSON或多表单实现

### 6. 底数表重新设计(核心变更)

**原设计问题**:
- 按机构日期维度,每种业务一行
- 新增业务需要添加列
- 不同业务字段差异大,大量NULL值

**新设计**:
```sql
-- 按字段维度存储,每个指标一行
STAT_BASE_DATA (
    FORM_ID,       -- 表单ID
    FORM_ITEM_ID,  -- 表单项ID(字段ID)
    STAT_DATE,     -- 统计日期
    ORG_ID,        -- 机构ID
    VALUE_TYPE,    -- 值类型: count/avg/rate/sum/composite
    VALUE_1,       -- 主值
    VALUE_2,       -- 辅助值1
    VALUE_3,       -- 辅助值2
    STAT_PERIOD    -- 统计周期: day/week/month/quarter/year
)
```

**优势**:
- ✅ 新增业务无需加列
- ✅ 支持多种指标类型
- ✅ 支持多时间维度统计
- ✅ 更细粒度,易于扩展

---

## 🏗️ 核心设计思想

### 1. 配置驱动

**传统方式(硬编码)**:
```java
// ❌ 新增业务需要改代码
@GetMapping("/population")
public List<PopulationVO> getPopulation() {
    return populationService.list();
}
```

**配置驱动方式**:
```java
// ✅ 新增业务只需配置
@GetMapping("/stat/data")
public List<Map<String, Object>> getStatData() {
    List<ColumnConfig> columns = columnService.getAll();
    return statService.getData(columns);
}
```

### 2. JSON存储 + 字段映射

**核心思想**:
- 所有数据完整存储在JSON字段中 (不丢数据)
- 重要字段映射到数据库列 (查询快,可建索引)
- 新增字段无需改表结构 (灵活扩展)

**示例**:
```sql
BIZ_DATA_COMMON (
    DATA_JSON CLOB,      -- 完整数据: {"checkTime":"2025-11-25","checker":"张三",...}
    DATE_1 DATE,         -- 映射字段: checkTime → DATE_1 (便于查询)
    FIELD_1 VARCHAR2,    -- 映射字段: checker → FIELD_1
    ...
)
```

### 3. 三层配置架构

```
第一层: 列配置 (SYS_COLUMN_CONFIG)
  ↓ 决定显示什么列
第二层: 表单配置 (SYS_FORM_CONFIG)
  ↓ 决定用什么表单
第三层: 表单项配置 (SYS_FORM_ITEM_CONFIG)
  ↓ 决定表单有什么字段
```

---

## 🔧 系统扩展能力

### 新增业务类别

**操作**: 仅需配置,无需改代码

```sql
-- 1. 配置列
INSERT INTO SYS_COLUMN_CONFIG (LABEL, PROP, FORM_ID) 
VALUES ('校园安全', 'campus_safety', 'FORM_CAMPUS');

-- 2. 配置表单
INSERT INTO SYS_FORM_CONFIG (FORM_CODE, FORM_NAME)
VALUES ('CAMPUS_SAFETY', '校园安全检查表单');

-- 3. 配置表单项
INSERT INTO SYS_FORM_ITEM_CONFIG (ITEM_LABEL, ITEM_PROP, ...)
VALUES ('检查时间', 'checkTime', ...);

-- 前端自动渲染!
```

### 新增表单字段

**情况1: 需要查询(索引字段)**
```sql
INSERT INTO SYS_FORM_ITEM_CONFIG (
    ITEM_LABEL, ITEM_PROP, IS_FIXED, TABLE_KEY
) VALUES (
    '整改期限', 'rectifyDeadline', '1', 'DATE_2'
);
-- 系统自动添加DATE_2列
```

**情况2: 不需要查询(仅展示)**
```sql
INSERT INTO SYS_FORM_ITEM_CONFIG (
    ITEM_LABEL, ITEM_PROP, IS_FIXED
) VALUES (
    '整改说明', 'rectifyRemark', '0'  -- 仅存JSON,无需改表
);
```

---

## 📊 完整示例

详见《系统设计讲解说明文档》第七章 - "社区矛盾纠纷统计模块完整配置示例"

---

## ❓ 常见问题FAQ

**Q1: 为什么不每个表单建一张独立的表?**

A: 采用通用表+JSON的优势:
- 一张表解决所有表单
- 新增业务无需改表
- 统计逻辑统一

**Q2: JSON查询性能会不会很差?**

A: 重要字段映射到表列,性能无忧!
- 查询条件用的字段 → 映射到表列(有索引)
- 仅展示的字段 → 存JSON即可

**Q3: 底数表为什么按字段维度设计?**

A: 更灵活!
- 新增统计指标无需加列
- 支持复杂指标(平均值、比率等)
- 便于扩展多维度分析

---

## 📞 联系与支持

如有问题,请参考:

1. 《系统设计讲解说明文档》- 详细的设计原理
2. 《文档更新说明》- 最新的变更记录
3. 各开发文档 - 具体的实现细节

---

## 📝 文档版本

| 版本 | 日期       | 说明                  |
| ---- | ---------- | --------------------- |
| 1.0  | 2025-11-25 | 初始版本              |
| 2.0  | 2025-11-25 | 全面优化,新增讲解文档 |

---

**项目状态**: 设计优化完成,待开发实现  
**文档维护**: AI Assistant  
**最后更新**: 2025-11-25
