# 项目依赖和入口文件说明

## 项目基本信息

- 项目名称: hdty-framework-w4
- 当前版本: 1.7.45
- 项目路径: /hdty-flex-view

## 核心技术栈

- Vue 2.6.14
- Vue Router 3.0.1
- Vuex 3.6.0
- Element UI 2.12.0
- ECharts 5.2.2
- Webpack 4.46.0

## 主要依赖包

### UI框架和组件库
- element-ui: Element UI组件库
- animate.css: CSS动画库
- viewerjs/v-viewer: 图片查看器
- vue-photo-preview: Vue图片预览插件
- vue-count-to: 数字滚动动画组件
- vue-izitoast: 消息提示插件

### 数据可视化
- echarts: 图表库
- @turf/turf: 地理空间分析库

### 富文本编辑器
- @wangeditor/editor: WangEditor富文本编辑器
- @tinymce/tinymce-vue: TinyMCE Vue组件
- tinymce: TinyMCE核心库

### 网络通信
- axios: HTTP客户端
- mqtt: MQTT协议客户端
- vue-native-websocket: Vue WebSocket插件

### 工具库
- core-js: JavaScript标准库polyfill
- dayjs: 日期处理库
- crypto-js: 加密算法库
- file-saver: 文件保存工具
- xlsx: Excel文件处理
- exceljs: Excel文件处理库
- jsoneditor: JSON编辑器
- nprogress: 进度条组件
- screenfull: 全屏功能

### 视频播放
- videojs-contrib-hls: HLS视频流播放
- vue-video-player: Vue视频播放器
- @easydarwin/easyplayer: EasyPlayer播放器

### 地图相关
- esri-loader: ArcGIS地图加载器

### 其他
- vue-cropper: 图片裁剪组件
- vue2-datepicker: 日期选择器
- vue-qr: 二维码生成器
- compressorjs: 图片压缩库

## 开发依赖

- @vue/cli-service: Vue CLI服务
- @vue/cli-plugin-babel: Babel插件
- @vue/cli-plugin-eslint: ESLint插件
- sass/sass-loader: Sass预处理器
- babel-eslint: Babel ESLint解析器
- eslint: 代码检查工具
- vue-template-compiler: Vue模板编译器

## 入口文件分析

### main.js - 应用入口文件

1. 环境初始化:
   - 动态获取当前用户类型并配置环境
   - 根据环境类型加载不同的配置文件 (appEnvDev / appEnvProd)

2. 全局样式和组件引入:
   - animate.css: 动画库
   - element-ui样式
   - 自定义样式文件

3. Vue插件注册:
   - VueIziToast: 消息提示
   - preview: 图片预览
   - Viewer: 图片查看器
   - animated: 动画效果
   - CountTo: 数字滚动组件

4. 全局属性挂载:
   - $echarts: 图表库
   - $jsoneditor: JSON编辑器
   - $erd: 元素尺寸检测器

5. 工具函数异步加载:
   - storage: 本地存储工具
   - crypto: 加密工具
   - util-*系列: 各类工具函数
   - axios-init: HTTP客户端初始化
   - socket/mqtt: 实时通信
   - watermark: 水印功能

6. 路由和状态管理:
   - 异步加载路由配置
   - 异步加载Vuex状态管理

7. Vue实例创建:
   - 挂载App组件
   - 注入路由和状态管理

### App.vue - 根组件

1. 路由视图容器:
   - 使用 `<router-view />` 渲染路由组件

2. 水印功能:
   - 根据路由状态动态设置水印
   - 支持登录页和着陆页的特殊处理

3. 主题和布局配置:
   - 从本地存储读取主题配置
   - 设置页面主题、尺寸、布局方式
   - 配置导航、选项卡、消息提示等功能

4. 系统消息通信:
   - 通过postMessage与父窗口通信
   - 接收外部主题和布局配置

### index.html - HTML模板

1. 页面元信息:
   - 字符编码、视口设置
   - IE兼容性设置
   - 缓存控制

2. 外部资源引入:
   - config.js: 系统配置文件
   - hdtyui.min.js: 自定义UI库
   - EasyPlayer: 视频播放器

### vue.config.js - 构建配置

1. 开发服务器配置:
   - 端口: 8060
   - 热更新启用
   - 静默编译输出

2. 路径和输出配置:
   - publicPath: 根据环境变量设置
   - outputDir: 版本号+项目名称
   - 禁用生产环境source map

3. 样式配置:
   - 全局SCSS变量注入
   - 主题和动画样式文件

4. Webpack配置:
   - 别名设置 (@指向src目录)
   - 环境变量定义
   - 打包分析插件 (按需启用)

5. 生产环境优化:
   - 删除prefetch插件
   - 代码分割策略:
     * 核心库单独打包 (vue, vue-router, vuex)
     * Element UI单独打包
     * ECharts单独打包
     * 其他node_modules合并打包
   - 运行时chunk合并
   - JS/CSS压缩优化
   - 控制台日志移除

### 路由配置

1. index.js:
   - 使用history模式
   - 路由守卫配置 (beforeEach, afterEach, onError)

2. routes.js:
   - 登录页面路由
   - 主布局路由
   - 个人中心路由
   - 通知公告路由
   - 错误页面路由 (400, 404, 406)
   - 重定向和着陆页路由

### 状态管理 (Vuex)

1. index.js:
   - 模块化状态管理
   - 中断所有HTTP请求功能
   - 重置所有状态功能
   - 清除登录痕迹功能

2. stores.js:
   - 应用配置状态 (主题、尺寸、布局等)
   - 对应的getters、mutations和actions

## 构建和开发命令

### 开发命令
- `npm run dev`: 启动开发服务器 (端口8060)
- `npm run serve`: 使用NVM切换版本后启动开发服务器

### 生产构建
- `npm run build`: 执行版本更新并构建
- `npm run build:no-version`: 跳过版本更新直接构建
- `npm run buildNVM`: 使用NVM切换版本后构建

### 其他命令
- `npm run lint`: 代码检查
- `npm run currentNVM`: 查看当前NVM版本
- `npm run listNVM`: 查看NVM版本列表
- `npm run useNVM`: 切换到Node.js 14.21.3

## 版本管理

- 使用version-updater.js自动更新版本号
- 版本格式: 主版本.次版本.修订版本 (如1.7.45)
- 每次构建时自动递增修订版本号
- 记录构建时间和版本历史